<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memorial Garden - Plant for Your Loved Ones</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/supabase/2.39.3/supabase.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 2rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .garden-container {
            position: relative;
            min-height: 600px;
            background: linear-gradient(to bottom, #87CEEB 0%, #90EE90 50%, #228B22 100%);
            margin: 2rem;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .garden {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 600px;
            cursor: crosshair;
        }

        .plant {
            position: absolute;
            transform-origin: bottom center;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .plant:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .tree {
            font-size: 3rem;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
        }

        .flower {
            font-size: 2rem;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.3));
        }

        .plant-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            white-space: nowrap;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .controls {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            max-width: 300px;
        }

        .plant-type {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .plant-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .plant-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .plant-btn.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            transform: scale(1.1);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .plant-memorial {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .plant-memorial:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem;
            margin: 1rem 2rem;
            border-radius: 15px;
            color: white;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }

        .memorial-count {
            position: fixed;
            top: 2rem;
            left: 2rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        @media (max-width: 768px) {
            .controls {
                position: static;
                margin: 1rem;
                max-width: none;
            }
            
            .memorial-count {
                position: static;
                margin: 1rem;
                text-align: center;
            }
            
            .garden-container {
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üå∏ Memorial Garden üå∏</h1>
        <p>Plant a tree or flower in memory of your loved one. Click anywhere in the garden to create a beautiful memorial that will bloom forever.</p>
    </div>

    <div class="instructions">
        üíù Choose a tree or flower below, fill in the memorial details, then click anywhere in the garden to plant your memorial. Hover over existing plants to see the loving memories others have shared.
    </div>

    <div class="memorial-count">
        <strong>üå± Memorials Planted: <span id="count">0</span></strong>
    </div>

    <div class="garden-container">
        <div class="garden" id="garden"></div>
        <div class="plant-tooltip" id="tooltip"></div>
    </div>

    <div class="controls">
        <div class="plant-type">
            <button class="plant-btn active" data-type="tree" title="Plant a Tree">üå≥</button>
            <button class="plant-btn" data-type="tree" title="Oak Tree">üå≤</button>
            <button class="plant-btn" data-type="flower" title="Rose">üåπ</button>
            <button class="plant-btn" data-type="flower" title="Sunflower">üåª</button>
            <button class="plant-btn" data-type="flower" title="Tulip">üå∑</button>
            <button class="plant-btn" data-type="flower" title="Cherry Blossom">üå∏</button>
        </div>
        
        <div class="form-group">
            <label for="loved-one-name">Loved One's Name:</label>
            <input type="text" id="loved-one-name" placeholder="Enter their name..." required>
        </div>
        
        <div class="form-group">
            <label for="memorial-message">Memorial Message:</label>
            <textarea id="memorial-message" placeholder="Share a loving memory or message..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="planted-by">Your Name (optional):</label>
            <input type="text" id="planted-by" placeholder="Your name...">
        </div>
        
        <button class="plant-memorial" id="plant-btn">üå± Ready to Plant</button>
    </div>

    <div class="loading" id="loading">Planting your memorial... üå±</div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://ytgrzhtntwzefwjmhgjj.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0Z3J6aHRudHd6ZWZ3am1oZ2pqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk2MTA4NjYsImV4cCI6MjA2NTE4Njg2Nn0.wx89qV1s1jePtZhuP5hnViu1KfPjMCnNrtUBW4bdbL8';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Plant types
        const plantTypes = {
            'üå≥': 'tree',
            'üå≤': 'tree', 
            'üåπ': 'flower',
            'üåª': 'flower',
            'üå∑': 'flower',
            'üå∏': 'flower'
        };

        let selectedPlant = 'üå≥';
        let isPlantingMode = false;
        let memorials = [];

        // DOM elements
        const garden = document.getElementById('garden');
        const tooltip = document.getElementById('tooltip');
        const loading = document.getElementById('loading');
        const countElement = document.getElementById('count');
        const plantBtns = document.querySelectorAll('.plant-btn');
        const plantBtn = document.getElementById('plant-btn');
        const lovedOneName = document.getElementById('loved-one-name');
        const memorialMessage = document.getElementById('memorial-message');
        const plantedBy = document.getElementById('planted-by');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadMemorials();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Plant type selection
            plantBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    plantBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedPlant = this.textContent;
                });
            });

            // Plant button
            plantBtn.addEventListener('click', function() {
                if (!lovedOneName.value.trim()) {
                    alert('Please enter your loved one\'s name.');
                    return;
                }
                
                if (isPlantingMode) {
                    isPlantingMode = false;
                    this.textContent = 'üå± Ready to Plant';
                    garden.style.cursor = 'crosshair';
                } else {
                    isPlantingMode = true;
                    this.textContent = '‚ùå Cancel Planting';
                    garden.style.cursor = 'copy';
                }
            });

            // Garden click
            garden.addEventListener('click', function(e) {
                if (isPlantingMode) {
                    plantMemorial(e);
                }
            });

            // Mouse events for tooltip
            garden.addEventListener('mousemove', handleMouseMove);
            garden.addEventListener('mouseleave', hideTooltip);
        }

        async function loadMemorials() {
            try {
                loading.style.display = 'block';
                
                // Try to get from memorials table, create if doesn't exist
                const { data, error } = await supabase
                    .from('memorials')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error && error.code === '42P01') {
                    // Table doesn't exist, create it
                    await createMemorialsTable();
                    memorials = [];
                } else if (error) {
                    console.error('Error loading memorials:', error);
                    memorials = [];
                } else {
                    memorials = data || [];
                }

                renderMemorials();
                updateCount();
            } catch (error) {
                console.error('Error loading memorials:', error);
                memorials = [];
            } finally {
                loading.style.display = 'none';
            }
        }

        async function createMemorialsTable() {
            // Note: This requires appropriate RLS policies and permissions
            // For now, we'll continue without creating the table automatically
            console.log('Memorials table needs to be created in Supabase dashboard');
        }

        async function plantMemorial(e) {
            if (!lovedOneName.value.trim()) return;

            const rect = garden.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;

            const memorial = {
                loved_one_name: lovedOneName.value.trim(),
                memorial_message: memorialMessage.value.trim(),
                planted_by: plantedBy.value.trim() || 'Anonymous',
                plant_type: selectedPlant,
                position_x: x,
                position_y: y,
                created_at: new Date().toISOString()
            };

            try {
                loading.style.display = 'block';
                
                const { data, error } = await supabase
                    .from('memorials')
                    .insert([memorial])
                    .select();

                if (error) {
                    console.error('Error saving memorial:', error);
                    // Continue with local storage as fallback
                    memorial.id = Date.now();
                    memorials.unshift(memorial);
                } else {
                    memorials.unshift(data[0]);
                }

                renderMemorials();
                updateCount();
                clearForm();
                isPlantingMode = false;
                plantBtn.textContent = 'üå± Ready to Plant';
                garden.style.cursor = 'crosshair';

            } catch (error) {
                console.error('Error planting memorial:', error);
                // Fallback to local storage
                memorial.id = Date.now();
                memorials.unshift(memorial);
                renderMemorials();
                updateCount();
                clearForm();
                isPlantingMode = false;
                plantBtn.textContent = 'üå± Ready to Plant';
                garden.style.cursor = 'crosshair';
            } finally {
                loading.style.display = 'none';
            }
        }

        function renderMemorials() {
            // Clear existing plants
            const existingPlants = garden.querySelectorAll('.plant');
            existingPlants.forEach(plant => plant.remove());

            // Render each memorial
            memorials.forEach(memorial => {
                const plant = document.createElement('div');
                plant.className = `plant ${plantTypes[memorial.plant_type]}`;
                plant.textContent = memorial.plant_type;
                plant.style.left = memorial.position_x + '%';
                plant.style.top = memorial.position_y + '%';
                plant.dataset.memorial = JSON.stringify(memorial);
                
                garden.appendChild(plant);
            });
        }

        function handleMouseMove(e) {
            const target = e.target;
            if (target.classList.contains('plant')) {
                const memorial = JSON.parse(target.dataset.memorial);
                showTooltip(e, memorial);
            } else {
                hideTooltip();
            }
        }

        function showTooltip(e, memorial) {
            const tooltipText = `üíù ${memorial.loved_one_name}\n${memorial.memorial_message ? memorial.memorial_message : 'Forever in our hearts'}\nüå± Planted by: ${memorial.planted_by}`;
            
            tooltip.innerHTML = tooltipText.replace(/\n/g, '<br>');
            tooltip.style.opacity = '1';
            tooltip.style.left = (e.pageX + 10) + 'px';
            tooltip.style.top = (e.pageY - 10) + 'px';
        }

        function hideTooltip() {
            tooltip.style.opacity = '0';
        }

        function clearForm() {
            lovedOneName.value = '';
            memorialMessage.value = '';
            plantedBy.value = '';
        }

        function updateCount() {
            countElement.textContent = memorials.length;
        }

        // Add some gentle animations
        setInterval(() => {
            const plants = document.querySelectorAll('.plant');
            plants.forEach(plant => {
                if (Math.random() < 0.1) {
                    plant.style.transform = 'scale(1.05) rotate(2deg)';
                    setTimeout(() => {
                        plant.style.transform = 'scale(1) rotate(0deg)';
                    }, 500);
                }
            });
        }, 3000);
    </script>
</body>
</html>