<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crisis Support Toolkit</title>
  <style>
    /* ===== Reset & base ===== */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
      color: #222;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    #app {
      flex: 1;
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem;
      background: rgba(255 255 255 / 0.85);
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
      overflow-y: auto;
    }
    h1 {
      font-weight: 900;
      font-size: 2.8rem;
      text-align: center;
      color: #2c3e50;
      margin-bottom: 0.2rem;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }
    h2 {
      font-weight: 700;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: #34495e;
      border-bottom: 3px solid #3498db;
      padding-bottom: 0.3rem;
    }
    button, select, input[type="text"], textarea {
      font-size: 1rem;
      border-radius: 6px;
      border: 1.5px solid #3498db;
      padding: 0.5rem 0.75rem;
      transition: background-color 0.3s ease, color 0.3s ease;
      cursor: pointer;
      font-family: inherit;
    }
    button:hover, select:hover, input[type="text"]:hover, textarea:hover {
      background-color: #3498db;
      color: white;
      border-color: #2980b9;
    }
    .btn-primary {
      background-color: #2980b9;
      color: white;
      border-color: #2980b9;
      font-weight: 700;
      padding: 0.6rem 1.1rem;
      user-select: none;
    }
    .btn-primary:hover {
      background-color: #1c5985;
      border-color: #1c5985;
    }
    .btn-danger {
      background-color: #e74c3c;
      color: white;
      border-color: #e74c3c;
      font-weight: 700;
    }
    .btn-danger:hover {
      background-color: #b32a1f;
      border-color: #b32a1f;
    }
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      align-items: center;
    }
    .section {
      margin-bottom: 2rem;
    }
    label {
      font-weight: 600;
      margin-bottom: 0.25rem;
      display: block;
      color: #2c3e50;
    }
    /* Crisis Resource Cards */
    .resource-card {
      background: white;
      border-left: 6px solid #3498db;
      border-radius: 8px;
      padding: 1rem 1.2rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      position: relative;
      max-width: 450px;
      margin: auto;
      margin-bottom: 1rem;
      transition: box-shadow 0.3s ease;
    }
    .resource-card.high-priority {
      border-left-color: #e74c3c;
      box-shadow: 0 0 10px 3px #f1948a;
    }
    .resource-card:hover {
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .resource-header {
      font-weight: 800;
      font-size: 1.15rem;
      color: #2c3e50;
      margin-bottom: 0.35rem;
    }
    .resource-description {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 0.6rem;
    }
    .contact-info {
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }
    .contact-label {
      font-weight: 700;
      color: #2980b9;
      margin-right: 0.25rem;
    }
    a.phone-link {
      color: #c0392b;
      font-weight: 700;
      text-decoration: none;
    }
    a.phone-link:hover {
      text-decoration: underline;
    }
    a.text-link {
      color: #2980b9;
      font-weight: 700;
      text-decoration: none;
    }
    a.text-link:hover {
      text-decoration: underline;
    }
    .languages {
      font-size: 0.85rem;
      color: #666;
      font-style: italic;
    }
    /* Breathing Exercise */
    #breathing-exercise {
      max-width: 360px;
      margin: 0 auto;
      text-align: center;
    }
    #breathing-circle {
      width: 120px;
      height: 120px;
      margin: 1rem auto;
      border-radius: 50%;
      background: #3498db;
      animation: breathCycle 16s ease-in-out infinite;
      box-shadow: 0 0 12px #2980b9;
    }
    @keyframes breathCycle {
      0%, 100% { transform: scale(1); background: #3498db; }
      25% { transform: scale(1.5); background: #2980b9; }
      50% { transform: scale(1); background: #3498db; }
      75% { transform: scale(0.5); background: #85c1e9; }
    }
    #breathing-text {
      font-weight: 600;
      font-size: 1.1rem;
      color: #2c3e50;
      margin-top: 0.6rem;
      min-height: 1.5rem;
    }
    /* Self Assessment */
    #self-assessment {
      max-width: 650px;
      margin: 1rem auto 2rem;
      padding: 1rem;
      background: #f4f8fb;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(52, 73, 94, 0.1);
    }
    #self-assessment h3 {
      margin-top: 0;
      margin-bottom: 0.75rem;
      color: #34495e;
    }
    .question {
      margin-bottom: 1.2rem;
    }
    .options label {
      display: block;
      padding: 0.4rem 0.2rem;
      cursor: pointer;
      border-radius: 6px;
      user-select: none;
      transition: background-color 0.25s ease;
      font-size: 0.95rem;
      color: #2c3e50;
    }
    .options label:hover {
      background-color: #d6eaf8;
    }
    input[type="radio"] {
      margin-right: 0.6rem;
      cursor: pointer;
    }
    #assessment-result {
      font-weight: 700;
      font-size: 1.2rem;
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      color: white;
    }
    .risk-high {
      background-color: #c0392b;
    }
    .risk-moderate {
      background-color: #d35400;
    }
    .risk-mild {
      background-color: #f39c12;
      color: #2c3e50;
    }
    .risk-low {
      background-color: #27ae60;
    }
    /* Safety Plan */
    #safety-plan {
      max-width: 650px;
      margin: 0 auto 2rem;
      background: #fafafa;
      padding: 1rem 1.2rem;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(52, 73, 94, 0.08);
    }
    #safety-plan label {
      font-weight: 600;
      margin-top: 0.8rem;
    }
    #safety-plan textarea, #safety-plan input[type="text"] {
      width: 100%;
      resize: vertical;
      padding: 0.6rem;
      border: 1.5px solid #3498db;
      border-radius: 6px;
      font-size: 1rem;
      color: #34495e;
      margin-top: 0.3rem;
    }
    #safety-plan button {
      margin-top: 1rem;
    }
    /* Language Toggle */
    #language-toggle {
      max-width: 650px;
      margin: 1rem auto 2rem;
      text-align: center;
    }
    /* Panic Exit */
    #panic-exit {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background-color: #e74c3c;
      color: white;
      padding: 0.75rem 1.1rem;
      border-radius: 30px;
      font-weight: 700;
      font-size: 1rem;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      cursor: pointer;
      border: none;
      transition: background-color 0.3s ease;
      z-index: 1000;
      user-select: none;
    }
    #panic-exit:hover {
      background-color: #b32a1f;
    }
    /* Responsive */
    @media (max-width: 700px) {
      #app {
        margin: 1rem;
        padding: 1rem;
      }
      .resource-card {
        max-width: 100%;
      }
      #breathing-circle {
        width: 90px;
        height: 90px;
      }
      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div id="app" role="main" aria-label="Crisis Support Toolkit">
    <h1 id="title">ðŸ§¡ Crisis Support Toolkit</h1>

    <!-- Language toggle -->
    <div id="language-toggle" role="region" aria-label="Language selection">
      <label for="language-select">Select Language / Choisir la langue:</label>
      <select id="language-select" aria-controls="app">
        <option value="en" selected>English</option>
        <option value="fr">FranÃ§ais</option>
      </select>
    </div>

    <!-- Country dropdown -->
    <div class="section flex-row" role="region" aria-label="Country selection">
      <label for="country-select" style="flex-basis:100%;">Select Your Country / SÃ©lectionnez votre pays:</label>
      <select id="country-select" aria-controls="resources" aria-describedby="country-description">
        <option value="usa" selected>ðŸ‡ºðŸ‡¸ USA</option>
        <option value="canada">ðŸ‡¨ðŸ‡¦ Canada</option>
      </select>
      <small id="country-description" style="width:100%; color:#555; font-style:italic; margin-top:-0.5rem;">Select to view country-specific resources.</small>
    </div>

    <!-- Category buttons -->
    <div class="section flex-row" role="region" aria-label="Resource category selection">
      <button class="btn-primary" data-category="immediate" aria-pressed="true">Immediate Crisis</button>
      <button class="btn-primary" data-category="mental" aria-pressed="false">Mental Health</button>
      <button class="btn-primary" data-category="specialized" aria-pressed="false">Specialized Support</button>
      <button class="btn-primary" data-category="addiction" aria-pressed="false">Addiction Support</button>
    </div>

    <!-- Crisis Resources -->
    <section id="resources" class="section" aria-live="polite" aria-atomic="true" aria-label="Crisis Resources">
      <!-- Resources will be injected here -->
    </section>

    <!-- Self Assessment -->
    <section id="self-assessment" class="section" aria-label="Mental health self assessment" hidden>
      <h2 id="self-assessment-title">Mental Health Self-Assessment</h2>
      <form id="assessment-form" aria-describedby="assessment-instructions">
        <p id="assessment-instructions" style="font-size:0.9rem; color:#555;">Answer the questions below to get an assessment of your current mental health state.</p>
        <!-- Questions inserted here -->
        <div id="questions-container"></div>
        <button type="submit" class="btn-primary" style="margin-top:1rem;">Get Results</button>
      </form>
      <div id="assessment-result" role="region" aria-live="polite" aria-atomic="true"></div>
    </section>

    <!-- Breathing Exercise -->
    <section id="breathing-exercise" class="section" aria-label="Guided breathing exercise">
      <h2>ðŸŒ€ Guided Breathing Exercise</h2>
      <div id="breathing-circle" aria-hidden="true"></div>
      <div id="breathing-text" aria-live="polite" aria-atomic="true">Breathe In...</div>
    </section>

    <!-- Safety Plan -->
    <section id="safety-plan" class="section" aria-label="Downloadable Safety Plan">
      <h2>ðŸ“‹ Safety Plan</h2>
      <form id="safety-form">
        <label for="warning-signs">Warning Signs:</label>
        <textarea id="warning-signs" rows="3" placeholder="What are your personal warning signs?"></textarea>

        <label for="coping-strategies">Coping Strategies:</label>
        <textarea id="coping-strategies" rows="3" placeholder="What helps you cope?"></textarea>

        <label for="support-contacts">Support Contacts (names & phone numbers):</label>
        <textarea id="support-contacts" rows="3" placeholder="Who can you call or text?"></textarea>

        <label for="professional-resources">Professional Resources:</label>
        <textarea id="professional-resources" rows="2" placeholder="Therapists, hotlines, etc."></textarea>

        <button type="button" class="btn-primary" id="download-safety-plan">Download Safety Plan</button>
      </form>
    </section>

    <!-- Panic Exit -->
    <button id="panic-exit" aria-label="Panic exit button, redirects immediately">Panic Exit</button>
  </div>

  <script>
    // Data resources:
    const resources = {
      usa: {
        immediate: [
          { id: 'us-988', name: '988 Suicide & Crisis Lifeline', phone: '988', available: '24/7', description: 'National suicide prevention lifeline. Press 1 for veterans.', languages: 'English, Spanish', highPriority: true },
          { id: 'us-text', name: 'Crisis Text Line', text: '741741', available: '24/7', description: 'Text HOME to 741741 for immediate crisis support.', languages: 'English, Spanish' },
          { id: 'us-samhsa', name: 'SAMHSA National Helpline', phone: '1-800-662-4357', available: '24/7', description: 'Mental health and substance abuse treatment referral.' }
        ],
        mental: [
          { id: 'us-nami', name: 'NAMI Helpline', phone: '1-800-950-6264', available: 'Mon-Fri 10am-10pm ET', description: 'National Alliance on Mental Illness support and information.' },
          { id: 'us-mha', name: 'Mental Health America', website: 'mhanational.org', available: 'Varies', description: 'Mental health screening and local resources.' }
        ],
        specialized: [
          { id: 'us-domestic', name: 'National Domestic Violence Hotline', phone: '1-800-799-7233', text: '88788', available: '24/7', description: 'Support for domestic violence survivors.', languages: 'Multiple languages' },
          { id: 'us-rainn', name: 'RAINN National Sexual Assault Hotline', phone: '1-800-656-4673', available: '24/7', description: 'Sexual assault support and resources.' },
          { id: 'us-lgbt', name: 'The Trevor Project (LGBTQ Youth)', phone: '1-866-488-7386', text: '678678', available: '24/7', description: 'Crisis support for LGBTQ+ youth.' },
          { id: 'us-veteran', name: 'Veterans Crisis Line', phone: '988', text: '838255', available: '24/7', description: 'Press 1 after calling 988 for veteran-specific support.' }
        ],
        addiction: [
          { id: 'us-samhsa-sub', name: 'SAMHSA Substance Abuse Helpline', phone: '1-800-662-4357', available: '24/7', description: 'Free treatment referral and information service.' },
          { id: 'us-aa', name: 'Alcoholics Anonymous', website: 'aa.org', available: 'Varies', description: 'Peer support for alcohol addiction recovery.' }
        ]
      },
      canada: {
        immediate: [
          { id: 'ca-988', name: '9-8-8: Suicide Crisis Helpline', phone: '988', available: '24/7', description: 'National suicide prevention service - call or text.', languages: 'English, French', highPriority: true },
          { id: 'ca-crisis', name: 'Crisis Services Canada', phone: '1-833-456-4566', text: '45645', available: '24/7', description: 'Support for suicide and mental health crises.' }
        ],
        mental: [
          { id: 'ca-mind', name: 'MindBeacon', website: 'mindbeacon.com', description: 'Online cognitive behavioral therapy programs.' },
          { id: 'ca-connex', name: 'ConnexOntario', phone: '1-866-531-2600', available: '24/7', description: 'Information about mental health, addictions, and problem gambling.' }
        ],
        specialized: [
          { id: 'ca-sexual-assault', name: 'Assaulted Womenâ€™s Helpline', phone: '1-866-863-0511', available: '24/7', description: 'Support for women experiencing abuse or violence.' },
          { id: 'ca-lgbtq', name: 'LGBT Youth Line', phone: '1-800-268-9688', available: '6pm-midnight ET', description: 'Peer support for LGBTQ youth.' }
        ],
        addiction: [
          { id: 'ca-addiction', name: 'Canada Drug and Alcohol Rehab', website: 'drugrehab.ca', description: 'Information and resources for addiction treatment.' }
        ]
      }
    };

    // Assessment questions
    const assessmentQuestions = [
      {
        id: 'q1',
        en: "In the past two weeks, how often have you felt down, depressed, or hopeless?",
        fr: "Au cours des deux derniÃ¨res semaines, Ã  quelle frÃ©quence vous Ãªtes-vous senti(e) dÃ©primÃ©(e) ou sans espoir ?",
        options: [
          { value: 0, en: "Not at all", fr: "Pas du tout" },
          { value: 1, en: "Several days", fr: "Quelques jours" },
          { value: 2, en: "More than half the days", fr: "Plus de la moitiÃ© des jours" },
          { value: 3, en: "Nearly every day", fr: "Presque tous les jours" }
        ]
      },
      {
        id: 'q2',
        en: "In the past two weeks, how often have you had little interest or pleasure in doing things?",
        fr: "Au cours des deux derniÃ¨res semaines, Ã  quelle frÃ©quence avez-vous eu peu dâ€™intÃ©rÃªt ou de plaisir Ã  faire des choses ?",
        options: [
          { value: 0, en: "Not at all", fr: "Pas du tout" },
          { value: 1, en: "Several days", fr: "Quelques jours" },
          { value: 2, en: "More than half the days", fr: "Plus de la moitiÃ© des jours" },
          { value: 3, en: "Nearly every day", fr: "Presque tous les jours" }
        ]
      },
      {
        id: 'q3',
        en: "Have you experienced thoughts of harming yourself or suicide recently?",
        fr: "Avez-vous rÃ©cemment eu des pensÃ©es dâ€™automutilation ou de suicide ?",
        options: [
          { value: 0, en: "No", fr: "Non" },
          { value: 3, en: "Yes", fr: "Oui" }
        ]
      },
      {
        id: 'q4',
        en: "How supported do you feel by your family or friends?",
        fr: "Dans quelle mesure vous sentez-vous soutenu(e) par votre famille ou vos amis ?",
        options: [
          { value: 3, en: "Not supported at all", fr: "Pas du tout soutenu(e)" },
          { value: 2, en: "Somewhat supported", fr: "Un peu soutenu(e)" },
          { value: 1, en: "Mostly supported", fr: "PlutÃ´t soutenu(e)" },
          { value: 0, en: "Very supported", fr: "TrÃ¨s soutenu(e)" }
        ]
      },
      {
        id: 'q5',
        en: "Do you currently have a plan to harm yourself or end your life?",
        fr: "Avez-vous actuellement un plan pour vous faire du mal ou mettre fin Ã  vos jours ?",
        options: [
          { value: 0, en: "No", fr: "Non" },
          { value: 3, en: "Yes", fr: "Oui" }
        ]
      },
      {
        id: 'q6',
        en: "How often do you feel overwhelmed by stress or anxiety?",
        fr: "Ã€ quelle frÃ©quence vous sentez-vous submergÃ©(e) par le stress ou lâ€™anxiÃ©tÃ© ?",
        options: [
          { value: 0, en: "Rarely or never", fr: "Rarement ou jamais" },
          { value: 1, en: "Sometimes", fr: "Parfois" },
          { value: 2, en: "Often", fr: "Souvent" },
          { value: 3, en: "Almost always", fr: "Presque toujours" }
        ]
      }
    ];

    // Localization strings
    const strings = {
      en: {
        immediate: 'Immediate Crisis',
        mental: 'Mental Health',
        specialized: 'Specialized Support',
        addiction: 'Addiction Support',
        selfAssessmentTitle: 'Mental Health Self-Assessment',
        assessmentInstructions: 'Answer the questions below to get an assessment of your current mental health state.',
        breathingTitle: 'ðŸŒ€ Guided Breathing Exercise',
        safetyPlanTitle: 'ðŸ“‹ Safety Plan',
        safetyPlanWarningSigns: 'Warning Signs:',
        safetyPlanCoping: 'Coping Strategies:',
        safetyPlanContacts: 'Support Contacts (names & phone numbers):',
        safetyPlanProfessional: 'Professional Resources:',
        downloadPlan: 'Download Safety Plan',
        panicExit: 'Panic Exit',
        languageSelect: 'Select Language:',
        countrySelect: 'Select Your Country:',
        panicExitConfirm: 'Are you sure you want to leave quickly?',
        downloadedFileName: 'safety-plan.txt',
        safetyPlanDownloadMessage: 'Safety plan downloaded.',
        riskLevelHigh: 'High Risk - Please seek immediate professional help or call a crisis line.',
        riskLevelModerate: 'Moderate Risk - Consider reaching out to trusted people or professionals.',
        riskLevelMild: 'Mild Risk - Keep monitoring your feelings and use coping strategies.',
        riskLevelLow: 'Low Risk - You seem to be doing well; continue self-care.',
      },
      fr: {
        immediate: 'Crise ImmÃ©diate',
        mental: 'SantÃ© Mentale',
        specialized: 'Soutien SpÃ©cialisÃ©',
        addiction: 'Soutien aux Addictions',
        selfAssessmentTitle: 'Auto-Ã©valuation de la SantÃ© Mentale',
        assessmentInstructions: 'RÃ©pondez aux questions ci-dessous pour Ã©valuer votre Ã©tat de santÃ© mentale actuel.',
        breathingTitle: 'ðŸŒ€ Exercice de Respiration GuidÃ©e',
        safetyPlanTitle: 'ðŸ“‹ Plan de SÃ©curitÃ©',
        safetyPlanWarningSigns: 'Signes Avant-coureurs:',
        safetyPlanCoping: 'StratÃ©gies dâ€™Adaptation:',
        safetyPlanContacts: 'Contacts de Soutien (noms & numÃ©ros):',
        safetyPlanProfessional: 'Ressources Professionnelles:',
        downloadPlan: 'TÃ©lÃ©charger le Plan de SÃ©curitÃ©',
        panicExit: 'Sortie Panique',
        languageSelect: 'Choisir la langue:',
        countrySelect: 'SÃ©lectionnez votre pays:',
        panicExitConfirm: 'Voulez-vous vraiment quitter rapidement ?',
        downloadedFileName: 'plan-de-securite.txt',
        safetyPlanDownloadMessage: 'Plan de sÃ©curitÃ© tÃ©lÃ©chargÃ©.',
        riskLevelHigh: 'Risque Ã‰levÃ© â€“ Veuillez demander immÃ©diatement une aide professionnelle ou appeler une ligne de crise.',
        riskLevelModerate: 'Risque ModÃ©rÃ© â€“ Envisagez de contacter des personnes de confiance ou des professionnels.',
        riskLevelMild: 'Risque LÃ©ger â€“ Continuez Ã  surveiller vos sentiments et utilisez des stratÃ©gies dâ€™adaptation.',
        riskLevelLow: 'Faible Risque â€“ Vous semblez aller bien; continuez Ã  prendre soin de vous.',
      }
    };

    let currentLang = 'en';

    // DOM elements
    const langSelect = document.getElementById('language-select');
    const countrySelect = document.getElementById('country-select');
    const resourcesSection = document.getElementById('resources');
    const categoryButtons = document.querySelectorAll('button[data-category]');
    const selfAssessmentSection = document.getElementById('self-assessment');
    const assessmentForm = document.getElementById('assessment-form');
    const questionsContainer = document.getElementById('questions-container');
    const assessmentResult = document.getElementById('assessment-result');
    const breathingText = document.getElementById('breathing-text');
    const breathingCircle = document.getElementById('breathing-circle');
    const safetyForm = document.getElementById('safety-form');
    const downloadPlanBtn = document.getElementById('download-safety-plan');
    const panicExitBtn = document.getElementById('panic-exit');
    const title = document.getElementById('title');
    const languageToggleLabel = document.querySelector('label[for="language-select"]');
    const countrySelectLabel = document.querySelector('label[for="country-select"]');

    // Initial state
    let currentCategory = 'immediate';

    // Utility to create phone links without buttons
    function createPhoneLink(number) {
      return `<a class="phone-link" href="tel:${number}">${number}</a>`;
    }
    // Utility to create text links
    function createTextLink(number) {
      return `<a class="text-link" href="sms:${number}">${number}</a>`;
    }
    // Utility to create website links
    function createWebsiteLink(url) {
      const fullUrl = url.startsWith('http') ? url : 'https://' + url;
      return `<a class="text-link" href="${fullUrl}" target="_blank" rel="noopener noreferrer">${url}</a>`;
    }

    // Render resource cards by category & country
    function renderResources() {
      const country = countrySelect.value;
      const data = resources[country];
      if (!data) {
        resourcesSection.innerHTML = `<p>No resources found for selected country.</p>`;
        return;
      }
      const list = data[currentCategory] || [];
      if (list.length === 0) {
        resourcesSection.innerHTML = `<p>No resources available in this category.</p>`;
        return;
      }
      resourcesSection.innerHTML = '';
      list.forEach(res => {
        const phoneHTML = res.phone ? createPhoneLink(res.phone) : '';
        const textHTML = res.text ? createTextLink(res.text) : '';
        const websiteHTML = res.website ? createWebsiteLink(res.website) : '';
        const langHTML = res.languages ? `<div class="languages">${res.languages}</div>` : '';
        resourcesSection.insertAdjacentHTML('beforeend', `
          <article class="resource-card ${res.highPriority ? 'high-priority' : ''}" tabindex="0" aria-labelledby="${res.id}-name" aria-describedby="${res.id}-desc">
            <h3 id="${res.id}-name" class="resource-header">${res.name}</h3>
            <p id="${res.id}-desc" class="resource-description">${res.description || ''}</p>
            <div class="contact-info"><span class="contact-label">Phone:</span>${phoneHTML || 'N/A'}</div>
            ${textHTML ? `<div class="contact-info"><span class="contact-label">Text:</span>${textHTML}</div>` : ''}
            ${websiteHTML ? `<div class="contact-info"><span class="contact-label">Website:</span>${websiteHTML}</div>` : ''}
            <div class="contact-info"><span class="contact-label">Availability:</span> ${res.available || 'Varies'}</div>
            ${langHTML}
          </article>
        `);
      });
    }

    // Render questions for assessment
    function renderAssessmentQuestions() {
      questionsContainer.innerHTML = '';
      assessmentQuestions.forEach(q => {
        const questionText = q[currentLang];
        const optionsHTML = q.options.map(opt =>
          `<label>
            <input type="radio" name="${q.id}" value="${opt.value}" required />
            ${opt[currentLang]}
          </label>`
        ).join('');
        questionsContainer.insertAdjacentHTML('beforeend', `
          <div class="question" role="group" aria-labelledby="${q.id}-label">
            <div id="${q.id}-label" style="font-weight:700; margin-bottom: 0.3rem;">${questionText}</div>
            <div class="options">${optionsHTML}</div>
          </div>
        `);
      });
      // Update labels for assessment section and instructions
      document.getElementById('self-assessment-title').textContent = strings[currentLang].selfAssessmentTitle;
      document.getElementById('assessment-instructions').textContent = strings[currentLang].assessmentInstructions;
    }

    // Show or hide self assessment depending on category
    function toggleSelfAssessment() {
      if (currentCategory === 'mental') {
        selfAssessmentSection.hidden = false;
      } else {
        selfAssessmentSection.hidden = true;
        assessmentResult.textContent = '';
        assessmentForm.reset();
      }
    }

    // Evaluate assessment result
    function evaluateAssessment(formData) {
      let totalScore = 0;
      for (const q of assessmentQuestions) {
        const val = formData.get(q.id);
        totalScore += val ? Number(val) : 0;
      }
      let riskText = '';
      let riskClass = '';
      if (totalScore >= 10) {
        riskText = strings[currentLang].riskLevelHigh;
        riskClass = 'risk-high';
      } else if (totalScore >= 6) {
        riskText = strings[currentLang].riskLevelModerate;
        riskClass = 'risk-moderate';
      } else if (totalScore >= 3) {
        riskText = strings[currentLang].riskLevelMild;
        riskClass = 'risk-mild';
      } else {
        riskText = strings[currentLang].riskLevelLow;
        riskClass = 'risk-low';
      }
      assessmentResult.textContent = riskText;
      assessmentResult.className = riskClass;
    }

    // Breathing exercise cycle
    const breathePhases = ['Breathe In...', 'Hold...', 'Breathe Out...', 'Hold...'];
    let breatheIndex = 0;
    function breatheCycle() {
      breathingText.textContent = breathePhases[breatheIndex];
      breatheIndex = (breatheIndex + 1) % breathePhases.length;
    }
    setInterval(breatheCycle, 4000); // change every 4s

    // Download Safety Plan as text file
    function downloadSafetyPlan() {
      const warningSigns = document.getElementById('warning-signs').value.trim();
      const copingStrategies = document.getElementById('coping-strategies').value.trim();
      const supportContacts = document.getElementById('support-contacts').value.trim();
      const professionalResources = document.getElementById('professional-resources').value.trim();

      let textContent = `${strings[currentLang].safetyPlanTitle}\n\n`;
      textContent += `${strings[currentLang].safetyPlanWarningSigns}\n${warningSigns || '[empty]'}\n\n`;
      textContent += `${strings[currentLang].safetyPlanCoping}\n${copingStrategies || '[empty]'}\n\n`;
      textContent += `${strings[currentLang].safetyPlanContacts}\n${supportContacts || '[empty]'}\n\n`;
      textContent += `${strings[currentLang].safetyPlanProfessional}\n${professionalResources || '[empty]'}\n\n`;

      const blob = new Blob([textContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = strings[currentLang].downloadedFileName;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 100);

      alert(strings[currentLang].safetyPlanDownloadMessage);
    }

    // Panic exit button
    panicExitBtn.addEventListener('click', () => {
      if (confirm(strings[currentLang].panicExitConfirm)) {
        // Redirect to a safe website instantly, e.g. google.com
        window.location.href = 'https://www.google.com';
      }
    });

    // Update language strings and UI
    function updateLanguage(lang) {
      currentLang = lang;
      title.textContent = 'ðŸ§¡ ' + (lang === 'en' ? 'Crisis Support Toolkit' : 'BoÃ®te Ã  outils de soutien en cas de crise');
      languageToggleLabel.textContent = strings[lang].languageSelect;
      countrySelectLabel.textContent = strings[lang].countrySelect;
      // Update buttons text
      categoryButtons.forEach(btn => {
        btn.textContent = strings[lang][btn.dataset.category];
      });
      // Update self-assessment & safety plan titles
      document.getElementById('self-assessment-title').textContent = strings[lang].selfAssessmentTitle;
      document.getElementById('assessment-instructions').textContent = strings[lang].assessmentInstructions;
      document.querySelector('#breathing-exercise h2').textContent = strings[lang].breathingTitle;
      document.querySelector('#safety-plan h2').textContent = strings[lang].safetyPlanTitle;
      document.querySelector('label[for="warning-signs"]').textContent = strings[lang].safetyPlanWarningSigns;
      document.querySelector('label[for="coping-strategies"]').textContent = strings[lang].safetyPlanCoping;
      document.querySelector('label[for="support-contacts"]').textContent = strings[lang].safetyPlanContacts;
      document.querySelector('label[for="professional-resources"]').textContent = strings[lang].safetyPlanProfessional;
      downloadPlanBtn.textContent = strings[lang].downloadPlan;
      panicExitBtn.textContent = strings[lang].panicExit;
      renderResources();
      renderAssessmentQuestions();
      toggleSelfAssessment();
    }

    // Event listeners
    langSelect.addEventListener('change', e => {
      updateLanguage(e.target.value);
    });
    countrySelect.addEventListener('change', renderResources);
    categoryButtons.forEach(btn => {
      btn.addEventListener('click', e => {
        currentCategory = e.target.dataset.category;
        categoryButtons.forEach(b => {
          b.setAttribute('aria-pressed', b === e.target ? 'true' : 'false');
        });
        renderResources();
        toggleSelfAssessment();
      });
    });
    assessmentForm.addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(assessmentForm);
      evaluateAssessment(formData);
    });
    downloadPlanBtn.addEventListener('click', downloadSafetyPlan);

    // Init app
    updateLanguage(currentLang);
  </script>
</body>
</html>