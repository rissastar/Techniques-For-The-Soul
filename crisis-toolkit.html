<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Crisis Support Toolkit</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#667eea">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    /* Base styles */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI',sans-serif; background:linear-gradient(135deg,#667eea,#764ba2); color:#333; min-height:100vh; padding-bottom:60px; scroll-behavior:smooth; }
    a { color:#3498db; text-decoration:none; }
    a:hover { text-decoration:underline; }
    button { cursor:pointer; border:none; border-radius:5px; transition:background .3s ease; }
    button:focus { outline:2px solid #3498db; }

    /* Containers */
    .container { max-width:900px; margin:1rem auto; background:rgba(255,255,255,0.9); border-radius:12px; padding:1rem; box-shadow:0 0 20px rgba(0,0,0,0.2); }
    header { text-align:center; margin-bottom:1rem; }
    h1 { font-size:2.2rem; }
    .subtitle { color:#555; }

    /* Starter prompts */
    .starter-prompts { background:#eef; padding:1rem; border-radius:8px; margin-top:1rem; font-size:0.9rem; }
    .starter-prompts ul { list-style:disc; padding-left:1.2rem; }

    /* Scroll buttons */
    .scroll-btns { position:fixed; bottom:80px; right:20px; display:flex; flex-direction:column; gap:10px; z-index:1000; }
    .scroll-btns button { width:48px;height:48px;border-radius:50%;background:#3498db;color:#fff; display:flex;align-items:center;justify-content:center; font-size:1.5rem; box-shadow:0 4px 8px rgba(0,0,0,0.2); }
    .scroll-btns button:hover { background:#2a80c7; }

    /* Modals */
    .modal-overlay { display:none; position:fixed; top:0;left:0;right:0;bottom:0; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; padding:15px; z-index:1500; }
    .modal-overlay.active { display:flex; }
    .modal { background:#fff; border-radius:10px; max-width:600px;width:100%; max-height:90vh; overflow-y:auto; padding:2rem; position:relative; }
    .modal h2 { margin-bottom:1rem; }
    .close-btn { position:absolute; top:12px; right:12px; background:transparent; font-size:1.4rem; cursor:pointer; color:#666; }
    .close-btn:hover { color:#3498db; }

    /* Safety plan form */
    label { display:block; margin-top:1rem; font-weight:600; }
    textarea { width:100%; min-height:80px; margin-top:0.4rem; padding:0.6rem; border-radius:6px; border:1px solid #3498db; font-family:inherit; font-size:1rem; resize:vertical; }
    .form-buttons { margin-top:1.5rem; display:flex; gap:10px; flex-wrap:wrap; }
    .primary-btn { background:#3498db; color:white; padding:0.8rem 1.4rem; border-radius:6px; }
    .secondary-btn { background:#aaa; color:white; padding:0.8rem 1.4rem; border-radius:6px; }

    /* Checklist */
    .checklist ul { list-style:none; padding-left:0; }
    .checklist li { margin:0.5rem 0; align-items:center; display:flex; gap:0.5rem; }
    .checklist input[type="checkbox"] { transform:scale(1.2); }

    /* Mobile styles */
    @media (max-width:600px){
      h1 { font-size:1.8rem; }
      .scroll-btns { bottom:60px; right:10px; }
    }
  </style>
</head>
<body>

  <!-- Scroll buttons -->
  <div class="scroll-btns">
    <button onclick="document.getElementById('safety-section').scrollIntoView()" title="Go to Safety Plan">üõ°Ô∏è</button>
    <button onclick="document.getElementById('checklist-section').scrollIntoView()" title="Go to Checklist">üìã</button>
  </div>

  <!-- Language toggle -->
  <div style="position:fixed;top:20px;right:20px;z-index:1000;">
    <button id="en-btn" class="primary-btn" onclick="setLanguage('en')">English</button>
    <button id="fr-btn" class="secondary-btn" onclick="setLanguage('fr')">Fran√ßais</button>
  </div>

  <div class="container">
    <header>
      <h1 id="page-title">üÜò Crisis Support Toolkit</h1>
      <p class="subtitle" id="page-subtitle">Immediate help and resources for Canada & USA</p>
      <p><strong id="page-strong">You are not alone. Help is available 24/7.</strong></p>
    </header>

    <section id="safety-section">
      <h2>üõ°Ô∏è Personalized Safety Plan</h2>
      <div class="starter-prompts">
        <p><em>Use these prompts:</em></p>
        <ul>
          <li>What are early warning signs? (e.g. racing thoughts)</li>
          <li>What healthy actions help? (e.g. walk, call)</li>
          <li>Who can I reach out to? (include phone numbers)</li>
          <li>Where can I go if unsafe? (e.g. ER)</li>
          <li>What steps keep my environment safe?</li>
        </ul>
      </div>
      <textarea id="safety-input" placeholder="Write your safety plan here..."></textarea>
      <div class="form-buttons">
        <button class="primary-btn" onclick="downloadPDF('safety-input','Safety_Plan.pdf')">Download PDF</button>
        <button class="secondary-btn" onclick="openModal('modal-safetyplan-fr')" title="Ouvrir le plan en fran√ßais">FR Plan</button>
      </div>
    </section>

    <section id="checklist-section" style="margin-top:2rem;">
      <h2>üìã Crisis Checklist</h2>
      <div class="checklist">
        <ul>
          <li><input type="checkbox"> Call a trusted friend or support line</li>
          <li><input type="checkbox"> Use deep-breathing techniques</li>
          <li><input type="checkbox"> Take medications (if prescribed)</li>
          <li><input type="checkbox"> Remove dangerous objects nearby</li>
          <li><input type="checkbox"> Remember emergency numbers</li>
          <li><input type="checkbox"> Go to hospital or call 911 if needed</li>
        </ul>
      </div>
      <button onclick="window.print()" class="secondary-btn">Print Checklist</button>
    </section>
  </div>

  <footer style="text-align:center;margin-top:2rem;color:#fff;">
    ¬© 2025 Crisis Support Toolkit
  </footer>

  <!-- French Safety Plan Modal -->
  <div id="modal-safetyplan-fr" class="modal-overlay">
    <div class="modal">
      <button class="close-btn" onclick="closeModal('modal-safetyplan-fr')">&times;</button>
      <h2>üõ°Ô∏è Mon plan de s√©curit√©</h2>
      <textarea id="safety-input-fr" placeholder="√âcrivez votre plan de s√©curit√© ici..."></textarea>
      <div class="form-buttons">
        <button class="primary-btn" onclick="downloadPDF('safety-input-fr','Plan_de_securite.pdf')">T√©l√©charger PDF</button>
      </div>
    </div>
  </div>

  <script>
    function setLanguage(lang) {
      const enBtn = document.getElementById('en-btn');
      const frBtn = document.getElementById('fr-btn');
      const title = document.getElementById('page-title');
      const subtitle = document.getElementById('page-subtitle');
      const strong = document.getElementById('page-strong');
      if (lang === 'fr') {
        enBtn.classList.replace('primary-btn','secondary-btn');
        frBtn.classList.replace('secondary-btn','primary-btn');
        title.textContent = "üÜò Trousse d'aide en situation de crise";
        subtitle.textContent = "Aide imm√©diate et ressources pour le Canada et les √âtats-Unis";
        strong.textContent = "Vous n'√™tes pas seul(e). De l'aide est disponible 24h/24,‚ÄØ7j/7.";
      } else {
        frBtn.classList.replace('primary-btn','secondary-btn');
        enBtn.classList.replace('secondary-btn','primary-btn');
        title.textContent = "üÜò Crisis Support Toolkit";
        subtitle.textContent = "Immediate help and resources for Canada & USA";
        strong.textContent = "You are not alone. Help is available 24/7.";
      }
    }
    setLanguage('en');

    function openModal(id) {
      document.getElementById(id).classList.add('active');
    }
    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    async function downloadPDF(inputId, filename) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const text = document.getElementById(inputId).value || '(No content entered)';
      doc.setFontSize(14);
      doc.text(filename.replace(/_/g, ' ').replace('.pdf',''), 14, 20);
      doc.setFontSize(11);
      const lines = doc.splitTextToSize(text, 180);
      doc.text(lines, 14, 30);
      doc.save(filename);
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .catch(err => console.warn('SW failed', err));
    }
  </script>
</body>
</html>