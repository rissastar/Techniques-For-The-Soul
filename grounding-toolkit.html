<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üåø Enhanced Grounding Toolkit</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<style>
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    color: white;
  }
  body::before {
    content: '';
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: 
      radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
      radial-gradient(circle at 40% 40%, rgba(120, 219, 226, 0.2) 0%, transparent 50%);
    pointer-events: none; z-index: -1;
  }
  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem;
    position: relative;
    z-index: 1;
  }
  .header {
    text-align: center;
    margin-bottom: 3rem;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }
  h1 {
    font-size: 3rem;
    font-weight: 700;
    background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 0.5rem;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  .subtitle {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.1rem;
    font-weight: 300;
    margin-bottom: 1rem;
  }
  .stats {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 1.5rem;
  }
  .stat {
    text-align: center;
    color: rgba(255, 255, 255, 0.9);
  }
  .stat-number {
    font-size: 1.5rem;
    font-weight: 600;
    display: block;
  }
  .stat-label {
    font-size: 0.9rem;
    opacity: 0.8;
  }
  .search-container {
    margin-bottom: 2rem;
    position: relative;
  }
  .search-input {
    width: 100%;
    padding: 1rem 1.5rem;
    font-size: 1rem;
    border: none;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
  }
  .search-input::placeholder {
    color: rgba(255, 255, 255, 0.6);
  }
  .search-input:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.4);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }
  .category-filters {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    justify-content: center;
  }
  .filter-btn {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.9);
    padding: 0.7rem 1.2rem;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .filter-btn:hover, .filter-btn.active {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }
  .accordion {
    display: grid;
    gap: 1rem;
  }
  .card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    animation: fadeInUp 0.6s ease forwards;
  }
  .card:nth-child(even) {
    animation-delay: 0.1s;
  }
  .card:nth-child(3n) {
    animation-delay: 0.2s;
  }
  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; height: 3px;
    background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57);
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .card:hover::before,
  .card.active::before {
    opacity: 1;
  }
  .card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
  }
  .card.active {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
    transform: scale(1.02);
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }
  .card-header::before {
    content: '';
    position: absolute;
    top: 0; left: -100%; width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s ease;
  }
  .card-header:hover::before {
    left: 100%;
  }
  .card-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  .card-title h3 {
    font-size: 1.2rem;
    font-weight: 600;
    color: white;
    margin: 0;
  }
  .card-emoji {
    font-size: 1.5rem;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  }
  .card-category {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
  }
  .card-toggle {
    font-size: 1.5rem;
    color: rgba(255, 255, 255, 0.7);
    transition: all 0.3s ease;
    transform-origin: center;
  }
  .card.active .card-toggle {
    transform: rotate(45deg);
    color: white;
  }
  .card-content {
    max-height: 0;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    background: rgba(255, 255, 255, 0.05);
  }
  .card-content.active {
    max-height: 1000px;
    padding: 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }
  .card-content p {
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.6;
    margin-bottom: 1rem;
    font-weight: 400;
  }
  .card-content ul {
    color: rgba(255, 255, 255, 0.9);
    padding-left: 1.5rem;
    line-height: 1.6;
  }
  .card-content li {
    margin-bottom: 0.5rem;
  }
  .button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    user-select: none;
  }
  .button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  }
  .checklist {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.75rem;
    margin: 1rem 0;
  }
  .checklist-item {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    padding: 0.75rem 1rem;
    border-radius: 15px;
    text-align: center;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    user-select: none;
  }
  .checklist-item:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
  }
  .timer-display {
    font-size: 2rem;
    font-weight: 700;
    color: white;
    text-align: center;
    margin: 1rem 0;
    font-family: 'Monaco', monospace;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  .progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    overflow: hidden;
    margin: 1rem 0;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4ecdc4, #44a08d);
    border-radius: 4px;
    transition: width 0.3s ease;
  }
  .meditation-guide {
    text-align: center;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    margin: 1rem 0;
  }
  .breath-circle {
    width: 150px;
    height: 150px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    margin: 1rem auto;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    transition: all 4s ease-in-out;
    user-select: none;
  }
  .breath-circle.inhale {
    transform: scale(1.3);
    border-color: #4ecdc4;
    background: rgba(78, 205, 196, 0.1);
  }
  .breath-circle.exhale {
    transform: scale(0.8);
    border-color: #ff6b6b;
    background: rgba(255, 107, 107, 0.1);
  }
  .floating-action {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    z-index: 1000;
    user-select: none;
  }
  .floating-action:hover {
    transform: scale(1.1) translateY(-2px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
  }
  .emergency-message {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 15px;
    margin: 1rem 0;
    text-align: center;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
  }
  @keyframes fadeInUp {
    from {
      opacity: 0; transform: translateY(30px);
    }
    to {
      opacity: 1; transform: translateY(0);
    }
  }
  /* Breathing animation keyframes */
  @keyframes pulseInhale {
    0%, 100% { transform: scale(1); border-color: #4ecdc4; background: rgba(78, 205, 196, 0.1);}
    50% { transform: scale(1.3); border-color: #1abc9c; background: rgba(26, 188, 156, 0.2);}
  }
  @keyframes pulseExhale {
    0%, 100% { transform: scale(1); border-color: #ff6b6b; background: rgba(255, 107, 107, 0.1);}
    50% { transform: scale(0.8); border-color: #c0392b; background: rgba(192, 57, 43, 0.2);}
  }
  /* Soothing sound toggle */
  #soundToggle {
    position: fixed;
    bottom: 2rem;
    left: 2rem;
    background: rgba(255, 255, 255, 0.15);
    border: none;
    border-radius: 50%;
    width: 60px; height: 60px;
    font-size: 1.5rem;
    color: white;
    cursor: pointer;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    transition: all 0.3s ease;
    z-index: 1000;
  }
  #soundToggle:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(1.1);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
  }
  @media (max-width: 768px) {
    .container {
      padding: 1rem;
    }
    h1 {
      font-size: 2rem;
    }
    .stats {
      gap: 1rem;
    }
    .category-filters {
      justify-content: flex-start;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }
    .filter-btn {
      flex-shrink: 0;
      font-size: 0.8rem;
      padding: 0.6rem 1rem;
    }
  }
</style>
</head>
<body>
  <div class="container" role="main" aria-label="Enhanced Grounding Toolkit">
    <header class="header">
      <h1>üåø Enhanced Grounding Toolkit</h1>
      <p class="subtitle">Calm your mind & reconnect with the present moment</p>
      <div class="stats" aria-live="polite" aria-atomic="true">
        <div class="stat">
          <span class="stat-number" id="techCount">0</span>
          <span class="stat-label">Techniques</span>
        </div>
        <div class="stat">
          <span class="stat-number" id="catCount">0</span>
          <span class="stat-label">Categories</span>
        </div>
      </div>
    </header>

    <section class="search-container" aria-label="Search grounding techniques">
      <input type="search" id="searchInput" class="search-input" placeholder="Search techniques..." aria-describedby="searchHelp" />
      <small id="searchHelp" style="color: #ddd; display: block; margin-top: 0.3rem; font-size: 0.8rem;">Type keywords like ‚Äúbreathing‚Äù, ‚Äúphysical‚Äù, ‚Äúmental‚Äù</small>
    </section>

    <section class="category-filters" aria-label="Filter techniques by category">
      <!-- dynamically inserted buttons -->
    </section>

    <section class="accordion" id="techniquesAccordion" aria-live="polite" aria-atomic="true">
      <!-- technique cards inserted here -->
    </section>

    <div class="meditation-guide" aria-label="Guided Breathing Exercise">
      <h2 style="margin-bottom: 1rem; font-weight: 600;">Guided Breathing Exercise</h2>
      <div class="breath-circle" id="breathCircle" aria-live="polite" aria-atomic="true">Inhale</div>
      <div class="timer-display" id="breathTimer" aria-live="polite" aria-atomic="true">4</div>
      <div style="text-align:center;">
        <button class="button" id="startBreathingBtn" aria-pressed="false">Start</button>
        <button class="button" id="stopBreathingBtn" disabled aria-pressed="false" style="margin-left: 1rem;">Stop</button>
      </div>
    </div>

    <div class="emergency-message" role="alert" aria-live="assertive" style="margin-top: 2rem;">
      If you feel overwhelmed or unsafe, <strong>please reach out for immediate help:</strong><br/>
      National Suicide Prevention Lifeline: <a href="tel:988" style="color:#fff; text-decoration: underline;">988</a> (USA)<br/>
      Crisis Text Line: Text <a href="sms:741741" style="color:#fff; text-decoration: underline;">741741</a><br/>
      Emergency Services: <a href="tel:911" style="color:#fff; text-decoration: underline;">911</a>
    </div>
  </div>

  <button id="soundToggle" aria-label="Toggle soothing ambient sounds" title="Toggle soothing ambient sounds">üéµ</button>

<script>
  (() => {
    // Grounding Techniques Data
    const techniques = [
      {
        id: 1,
        title: "5-4-3-2-1 Grounding",
        emoji: "üñêÔ∏è",
        category: "Mental",
        description: `Use your senses to notice:
          <ul>
            <li>5 things you can see</li>
            <li>4 things you can touch</li>
            <li>3 things you can hear</li>
            <li>2 things you can smell</li>
            <li>1 thing you can taste</li>
          </ul>
          This technique helps bring your focus to the present moment.`
      },
      {
        id: 2,
        title: "Box Breathing",
        emoji: "üì¶",
        category: "Breathing",
        description: `Breathe in for 4 seconds, hold for 4 seconds, breathe out for 4 seconds, hold for 4 seconds.<br/>
        Repeat 4-5 times to calm your nervous system.`
      },
      {
        id: 3,
        title: "Physical Grounding - Touch",
        emoji: "‚úã",
        category: "Physical",
        description: `Touch a nearby object and focus on its texture, temperature, and shape.<br/>
        Describe it silently or aloud to yourself to stay anchored.`
      },
      {
        id: 4,
        title: "Guided Visualization",
        emoji: "üåÖ",
        category: "Mental",
        description: `Close your eyes and imagine a safe, peaceful place.<br/>
        Visualize the details: sights, sounds, smells, and sensations.<br/>
        Stay there for 5 minutes to relax.`
      },
      {
        id: 5,
        title: "Stretching Break",
        emoji: "ü§∏‚Äç‚ôÇÔ∏è",
        category: "Physical",
        description: `Slowly stretch your arms, neck, and legs.<br/>
        Move gently and notice how your muscles feel as you stretch.`
      },
      {
        id: 6,
        title: "Grounding with Temperature",
        emoji: "‚ùÑÔ∏èüî•",
        category: "Physical",
        description: `Hold a cold or warm object (like a cool cloth or warm cup).<br/>
        Notice the temperature and sensation to ground yourself physically.`
      },
      {
        id: 7,
        title: "Mantra Repetition",
        emoji: "üïâÔ∏è",
        category: "Mental",
        description: `Silently repeat a calming word or phrase (e.g. ‚ÄúI am safe‚Äù).<br/>
        Use it to focus and reduce anxious thoughts.`
      },
      {
        id: 8,
        title: "Breath Counting",
        emoji: "üßò‚Äç‚ôÇÔ∏è",
        category: "Breathing",
        description: `Breathe normally and count each exhale silently from 1 to 10.<br/>
        When you reach 10, start over.`
      },
      {
        id: 9,
        title: "Grounding Walk",
        emoji: "üö∂‚Äç‚ôÄÔ∏è",
        category: "Physical",
        description: `Take a slow walk and focus on each step and your surroundings.<br/>
        Notice the sensation of your feet touching the ground.`
      },
      {
        id: 10,
        title: "Progressive Muscle Relaxation",
        emoji: "üíÜ‚Äç‚ôÇÔ∏è",
        category: "Physical",
        description: `Tense and release muscle groups progressively from feet to head.<br/>
        Helps reduce physical tension and anxiety.`
      }
    ];

    // DOM refs
    const container = document.querySelector('.container');
    const accordion = document.getElementById('techniquesAccordion');
    const searchInput = document.getElementById('searchInput');
    const categoryFilters = document.querySelector('.category-filters');
    const techCountSpan = document.getElementById('techCount');
    const catCountSpan = document.getElementById('catCount');
    const breathCircle = document.getElementById('breathCircle');
    const breathTimer = document.getElementById('breathTimer');
    const startBtn = document.getElementById('startBreathingBtn');
    const stopBtn = document.getElementById('stopBreathingBtn');
    const soundToggle = document.getElementById('soundToggle');

    // Categories
    const categories = [...new Set(techniques.map(t => t.category))].sort();

    // State
    let currentCategory = null;
    let currentSearch = '';
    let activeCard = null;

    // Render categories
    function renderCategories() {
      categoryFilters.innerHTML = '';

      // "All" filter
      const allBtn = document.createElement('button');
      allBtn.textContent = 'All';
      allBtn.className = 'filter-btn active';
      allBtn.setAttribute('aria-pressed', 'true');
      allBtn.addEventListener('click', () => {
        currentCategory = null;
        updateCategoryActive();
        renderTechniques();
      });
      categoryFilters.appendChild(allBtn);

      categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.textContent = cat;
        btn.className = 'filter-btn';
        btn.setAttribute('aria-pressed', 'false');
        btn.addEventListener('click', () => {
          currentCategory = cat;
          updateCategoryActive();
          renderTechniques();
        });
        categoryFilters.appendChild(btn);
      });

      catCountSpan.textContent = categories.length;
    }

    function updateCategoryActive() {
      [...categoryFilters.children].forEach(btn => {
        if ((btn.textContent === currentCategory) || (currentCategory === null && btn.textContent === 'All')) {
          btn.classList.add('active');
          btn.setAttribute('aria-pressed', 'true');
        } else {
          btn.classList.remove('active');
          btn.setAttribute('aria-pressed', 'false');
        }
      });
    }

    // Render techniques with filter & search
    function renderTechniques() {
      accordion.innerHTML = '';
      let filtered = techniques;

      if (currentCategory) {
        filtered = filtered.filter(t => t.category === currentCategory);
      }
      if (currentSearch.trim()) {
        const searchLower = currentSearch.toLowerCase();
        filtered = filtered.filter(t =>
          t.title.toLowerCase().includes(searchLower) ||
          t.description.toLowerCase().includes(searchLower) ||
          t.category.toLowerCase().includes(searchLower)
        );
      }

      techCountSpan.textContent = filtered.length;

      if (filtered.length === 0) {
        accordion.innerHTML = '<p style="color: rgba(255,255,255,0.7); font-style: italic; text-align:center;">No techniques found matching your criteria.</p>';
        return;
      }

      filtered.forEach(t => {
        const card = document.createElement('article');
        card.className = 'card';
        card.setAttribute('tabindex', '0');
        card.setAttribute('role', 'region');
        card.setAttribute('aria-labelledby', `title-${t.id}`);

        const header = document.createElement('div');
        header.className = 'card-header';
        header.setAttribute('role', 'button');
        header.setAttribute('aria-expanded', 'false');
        header.setAttribute('aria-controls', `content-${t.id}`);
        header.id = `header-${t.id}`;
        header.tabIndex = 0;

        const titleDiv = document.createElement('div');
        titleDiv.className = 'card-title';

        const emojiSpan = document.createElement('span');
        emojiSpan.className = 'card-emoji';
        emojiSpan.textContent = t.emoji;

        const titleH3 = document.createElement('h3');
        titleH3.className = 'card-title-text';
        titleH3.id = `title-${t.id}`;
        titleH3.textContent = t.title;

        titleDiv.appendChild(emojiSpan);
        titleDiv.appendChild(titleH3);

        const categorySpan = document.createElement('span');
        categorySpan.className = 'card-category';
        categorySpan.textContent = t.category;

        const toggleSpan = document.createElement('span');
        toggleSpan.className = 'card-toggle';
        toggleSpan.innerHTML = '+';

        header.appendChild(titleDiv);
        header.appendChild(categorySpan);
        header.appendChild(toggleSpan);

        const content = document.createElement('div');
        content.className = 'card-content';
        content.id = `content-${t.id}`;
        content.setAttribute('aria-hidden', 'true');
        content.innerHTML = t.description;

        card.appendChild(header);
        card.appendChild(content);

        // Click / keyboard toggle event
        function toggleCard() {
          const expanded = header.getAttribute('aria-expanded') === 'true';
          if (expanded) {
            header.setAttribute('aria-expanded', 'false');
            content.setAttribute('aria-hidden', 'true');
            card.classList.remove('active');
            toggleSpan.textContent = '+';
          } else {
            // close others
            [...accordion.children].forEach(c => {
              const hdr = c.querySelector('.card-header');
              const cnt = c.querySelector('.card-content');
              const tg = c.querySelector('.card-toggle');
              if (hdr && cnt) {
                hdr.setAttribute('aria-expanded', 'false');
                cnt.setAttribute('aria-hidden', 'true');
                c.classList.remove('active');
                if(tg) tg.textContent = '+';
              }
            });
            header.setAttribute('aria-expanded', 'true');
            content.setAttribute('aria-hidden', 'false');
            card.classList.add('active');
            toggleSpan.textContent = '√ó';
            card.focus();
          }
        }

        header.addEventListener('click', toggleCard);
        header.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            toggleCard();
          }
        });

        accordion.appendChild(card);
      });
    }

    // Search input listener
    searchInput.addEventListener('input', (e) => {
      currentSearch = e.target.value;
      renderTechniques();
    });

    // Initialize
    renderCategories();
    renderTechniques();

    // Breathing exercise logic
    /*
      Pattern: Inhale 4s ‚Üí Hold 4s ‚Üí Exhale 4s ‚Üí Hold 4s ‚Üí repeat
    */
    const breathCycleTimes = {
      inhale: 4,
      hold1: 4,
      exhale: 4,
      hold2: 4
    };
    const phases = ['inhale', 'hold1', 'exhale', 'hold2'];

    let breathInterval = null;
    let currentPhaseIndex = 0;
    let currentSeconds = breathCycleTimes[phases[0]];
    let running = false;

    function updateBreathUI() {
      const phase = phases[currentPhaseIndex];
      breathCircle.textContent = phase.charAt(0).toUpperCase() + phase.slice(1).replace(/[0-9]/g, '');
      breathTimer.textContent = currentSeconds;

      // Set circle class for animation/color
      breathCircle.className = 'breath-circle';
      if (phase === 'inhale') {
        breathCircle.classList.add('inhale');
      } else if (phase === 'exhale') {
        breathCircle.classList.add('exhale');
      }

      // Accessibility live region update (aria-live handled)
    }

    function breathTick() {
      if (!running) return;
      currentSeconds--;
      if (currentSeconds < 0) {
        currentPhaseIndex = (currentPhaseIndex + 1) % phases.length;
        currentSeconds = breathCycleTimes[phases[currentPhaseIndex]];
      }
      updateBreathUI();
    }

    function startBreathing() {
      if (running) return;
      running = true;
      startBtn.disabled = true;
      stopBtn.disabled = false;
      startBtn.setAttribute('aria-pressed', 'true');
      stopBtn.setAttribute('aria-pressed', 'false');
      currentPhaseIndex = 0;
      currentSeconds = breathCycleTimes[phases[0]];
      updateBreathUI();
      breathInterval = setInterval(breathTick, 1000);
    }

    function stopBreathing() {
      running = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;
      startBtn.setAttribute('aria-pressed', 'false');
      stopBtn.setAttribute('aria-pressed', 'true');
      breathCircle.textContent = 'Inhale';
      breathTimer.textContent = '4';
      breathCircle.className = 'breath-circle inhale';
      clearInterval(breathInterval);
    }

    startBtn.addEventListener('click', startBreathing);
    stopBtn.addEventListener('click', stopBreathing);

    // Soothing sound embed
    const ambientAudio = new Audio('https://cdn.pixabay.com/download/audio/2021/10/26/audio_439c76c5bb.mp3?filename=forest-birds-ambient-11327.mp3');
    ambientAudio.loop = true;
    ambientAudio.volume = 0.25;

    let soundPlaying = false;

    function toggleSound() {
      if (soundPlaying) {
        ambientAudio.pause();
        soundPlaying = false;
        soundToggle.textContent = 'üéµ';
        soundToggle.setAttribute('aria-pressed', 'false');
      } else {
        ambientAudio.play();
        soundPlaying = true;
        soundToggle.textContent = 'üîà';
        soundToggle.setAttribute('aria-pressed', 'true');
      }
    }

    soundToggle.addEventListener('click', toggleSound);

    // Clean up audio on page unload
    window.addEventListener('beforeunload', () => {
      ambientAudio.pause();
      ambientAudio.currentTime = 0;
    });
  })();
</script>
</body>
</html>