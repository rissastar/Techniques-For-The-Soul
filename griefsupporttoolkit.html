<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grief Support Toolkit</title>
  <style>
    /* ===== GOOGLE FONT ===== */
    @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap');

    /* ===== CSS VARIABLES for Themes ===== */
    :root {
      --bg-gradient: linear-gradient(135deg, #d9c1ff, #a4a4ff);
      --text-color: #3a1c6f;
      --card-bg: #fff;
      --card-shadow: rgba(102,84,204,0.25);
      --primary: #7f5af0;
      --primary-light: #a865f9;
      --accent: #4b2ca9;
    }
    body.theme-dark {
      --bg-gradient: #121212;
      --text-color: #ddd;
      --card-bg: #1e1e1e;
      --card-shadow: rgba(0,0,0,0.7);
      --primary: #4a90e2;
      --primary-light: #72b5f9;
      --accent: #aad1f7;
    }
    body.theme-calm {
      --bg-gradient: linear-gradient(135deg, #f0f4f8, #c8d8e5);
      --text-color: #333;
      --card-bg: #fff;
      --card-shadow: rgba(100,100,120,0.15);
      --primary: #88c0d0;
      --primary-light: #b0dfee;
      --accent: #5e81ac;
    }

    /* ===== RESET & BASE ===== */
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Comfortaa', cursive, sans-serif;
      background: var(--bg-gradient);
      color: var(--text-color);
      min-height: 100vh;
      padding: 1rem;
      transition: background 0.5s, color 0.5s;
    }
    h1 { text-align:center; font-size:2.6rem; margin-bottom:1rem; color:var(--accent); }
    button, select, textarea {
      font-family: inherit;
      border:none;
      border-radius:8px;
      cursor:pointer;
    }
    button, select {
      background: var(--primary);
      color: #fff;
      padding:0.6rem 1rem;
      transition: background 0.3s;
    }
    button:hover, select:hover { background: var(--primary-light); }
    button:focus, select:focus, textarea:focus { outline:2px solid var(--accent); }

    /* ===== Layout ===== */
    .container { max-width:1100px; margin:0 auto; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(300px,1fr)); gap:1.5rem; }

    section.card {
      background: var(--card-bg);
      border-radius:12px;
      padding:1.5rem;
      box-shadow: 0 8px 25px var(--card-shadow);
      position: relative;
      transition: box-shadow 0.3s;
    }
    section.card:hover { box-shadow: 0 12px 30px var(--card-shadow); }
    section.card h2 {
      display:flex; align-items:center; gap:0.6rem;
      font-size:1.4rem; margin-bottom:1rem; color:var(--accent);
    }
    .icon { font-size:1.8rem; }

    /* ===== THEME SELECTOR ===== */
    #themeSelector {
      position: fixed; top:1rem; left:1rem; z-index:100;
    }

    /* ===== SOS BUTTON ===== */
    #sosBtn {
      position: fixed; bottom:1rem; left:1rem;
      background:#e03e3e; color:#fff; width:52px; height:52px; 
      border-radius:50%; font-size:1.8rem; display:flex; align-items:center; justify-content:center;
      z-index:100;
    }
    #sosBtn:hover { background:#c13030; }

    /* ===== Sections Styles ===== */
    /* Memory Garden */
    #garden { display:flex; flex-wrap:wrap; gap:0.6rem; margin-top:1rem; }
    .garden-item {
      background: var(--primary-light); color:white; padding:0.6rem 0.8rem;
      border-radius:20px; cursor:pointer; transition:transform 0.2s;
    }
    .garden-item:hover { transform:scale(1.1); }

    /* Grief-in-Body Explorer */
    .body-map { background:url('https://i.imgur.com/YOuYWbS.png') center/contain no-repeat;
      width:100%; height:260px; position:relative; margin-bottom:1rem;
    }
    .body-spot { position:absolute; width:20px; height:20px;
      background:rgba(255,0,0,0.6); border-radius:50%; cursor:pointer; transition:background 0.3s;
    }
    .body-spot:hover { background:red; }

    /* Letters to Loved Ones */
    #loveLetter { width:100%; min-height:120px; border:2px solid var(--primary);
      border-radius:8px; padding:0.8rem; resize:vertical; margin-bottom:0.6rem;
    }

    /* Comfort Plan Builder */
    .plan-builder label { display:block; margin-top:0.8rem; font-weight:600; }
    .plan-builder input, .plan-builder textarea {
      width:100%; padding:0.6rem; border-radius:6px; border:1px solid #ccc; margin-top:0.4rem;
    }

    /* Myth Busters Carousel */
    .carousel { overflow:hidden; }
    .carousel-track {
      display:flex; transition:transform 0.4s ease;
    }
    .carousel-card {
      min-width:280px; flex-shrink:0; background:var(--card-bg);
      border-radius:10px; padding:1rem; margin-right:1rem; box-shadow:0 4px 16px var(--card-shadow);
    }
    .carousel-controls { text-align:center; margin-top:0.6rem; }
    .carousel-btn { background: var(--primary); margin:0 0.2rem; }

    /* Modal Overlay */
    .modal-overlay {
      display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7);
      justify-content:center; align-items:center; padding:1rem; z-index:500;
    }
    .modal-overlay.active { display:flex; }
    .modal-content {
      background:white; padding:1.5rem; border-radius:12px;
      max-width:500px; max-height:80vh; overflow-y:auto;
      box-shadow:0 8px 30px var(--card-shadow); position:relative;
    }
    .modal-close {
      position:absolute; top:0.6rem; right:0.8rem;
      background:transparent; font-size:1.6rem; cursor:pointer; color:var(--accent);
    }

    /* Mood Tracker */
    .mood-buttons { display:flex; justify-content:space-between; margin-bottom:1rem; }
    .mood-btn {
      flex-grow:1; margin:0 0.2rem; font-size:2.2rem; background:#ddd; border-radius:10px;
      display:flex; align-items:center; justify-content:center; transition:transform 0.2s,background 0.3s;
    }
    .mood-btn[aria-checked="true"], .mood-btn:hover, .mood-btn:focus {
      background: var(--primary); color:#fff; transform:scale(1.1); outline:none;
      box-shadow:0 0 12px var(--card-shadow);
    }
    .progress-bar { background:#eee; border-radius:20px; height:10px; overflow:hidden; }
    .progress-fill { height:100%; background:var(--primary-light); width:0; transition:width 0.4s; }
    #moodMessage { margin-top:0.8rem; font-style:italic; font-weight:600; color:var(--accent); }

    /* Journal */
    #journalEntry { width:100%; height:120px; border:2px solid #dcd7ff; border-radius:10px;
      padding:0.8rem; margin-bottom:0.6rem; resize:vertical; }
    #journalEntry:focus { border-color:var(--primary); }
    #journalMessage { font-weight:600; color:var(--accent); }

    /* Additional Resources & Contacts */
    ul { padding-left:1.2rem; margin-top:0; }
    ul li { margin-bottom:0.5rem; }
    ul li a { color:var(--primary); font-weight:600; text-decoration:none; }
    ul li a:hover, ul li a:focus { text-decoration:underline; outline:none; }

    /* Responsive */
    @media (max-width:600px) {
      .grid { display:block; }
      #themeSelector { top:0.5rem; left:0.5rem; }
      #sosBtn { bottom:0.5rem; left:0.5rem; }
    }
  </style>
</head>
<body>

  <!-- Theme Selector -->
  <select id="themeSelector">
    <option value="light">Light Theme</option>
    <option value="dark">Dark Theme</option>
    <option value="calm">Calm Pastel</option>
  </select>

  <!-- SOS Button -->
  <button id="sosBtn" aria-label="SOS Button">üÜò</button>

  <h1>Grief Support Toolkit</h1>
  <div class="container">
    <div class="grid">

      <!-- Section: Memory Garden -->
      <section class="card" aria-labelledby="garden-title">
        <h2 id="garden-title"><span class="icon">üå∫</span>Memory Garden</h2>
        <p>Plant a tribute for someone you miss.</p>
        <button id="plantBtn">Plant Tribute</button>
        <div id="garden"></div>
      </section>

      <!-- Section: Grief in Your Body Explorer -->
      <section class="card" aria-labelledby="body-title">
        <h2 id="body-title"><span class="icon">üó∫Ô∏è</span>Grief in Your Body</h2>
        <p>Click areas to learn how grief can show physically.</p>
        <div class="body-map" id="bodyMap"></div>
      </section>

      <!-- Section: Letters to Loved Ones -->
      <section class="card" aria-labelledby="letter-title">
        <h2 id="letter-title"><span class="icon">üíå</span>Letters to Loved Ones</h2>
        <textarea id="loveLetter" placeholder="Write a letter..."></textarea>
        <button id="saveLetterBtn">Save Letter</button>
      </section>

      <!-- Section: Comfort Plan Builder -->
      <section class="card" aria-labelledby="plan-title">
        <h2 id="plan-title"><span class="icon">üõ°Ô∏è</span>Comfort Plan Builder</h2>
        <div class="plan-builder">
          <label for="helpContact">Who to call:</label>
          <input id="helpContact" placeholder="Name & phone/email" />
          <label for="soothingActivities">Soothing activities:</label>
          <textarea id="soothingActivities" placeholder="e.g. music, walk"></textarea>
          <label for="avoidList">What to avoid:</label>
          <textarea id="avoidList" placeholder="e.g. social media"></textarea>
          <label for="affirmations">My affirmations:</label>
          <textarea id="affirmations" placeholder="e.g. I am allowed to feel"></textarea>
          <button id="savePlanBtn">Save My Plan</button>
        </div>
      </section>

      <!-- Section: Grief Myth Busters Carousel -->
      <section class="card" aria-labelledby="myth-title">
        <h2 id="myth-title"><span class="icon">‚ùå</span>Grief Myth Busters</h2>
        <div class="carousel" tabindex="0">
          <div class="carousel-track" id="mythTrack">
            <div class="carousel-card">
              <p><strong>Myth:</strong> Time heals all wounds.</p>
              <p><em>Reality:</em> Healing is ongoing; you learn to live with pain.</p>
            </div>
            <div class="carousel-card">
              <p><strong>Myth:</strong> You should be ‚Äúover it‚Äù by now.</p>
              <p><em>Reality:</em> Grief has no timeline‚Äîevery journey is unique.</p>
            </div>
            <div class="carousel-card">
              <p><strong>Myth:</strong> Crying means weakness.</p>
              <p><em>Reality:</em> Tears are healing, not a sign of weakness.</p>
            </div>
          </div>
        </div>
        <div class="carousel-controls">
          <button class="carousel-btn" id="prevMyth">‚ü®</button>
          <button class="carousel-btn" id="nextMyth">‚ü©</button>
        </div>
      </section>

    </div>

    <h2 style="margin-top:2rem; color:var(--accent);">Core Toolkit</h2>
    <div class="grid">

      <!-- Understanding Grief -->
      <section class="card" aria-labelledby="ugb-title">
        <h2 id="ugb-title"><span class="icon">üí°</span>Understanding Grief</h2>
        <p>Grief is a natural response to loss with many emotions and stages.</p>
        <button id="openGriefModal">Read More</button>
      </section>

      <!-- Coping Strategies -->
      <section class="card" aria-labelledby="cs-title">
        <h2 id="cs-title"><span class="icon">üõ†Ô∏è</span>Coping Strategies</h2>
        <div class="strategy-list">
          <button class="strategy-card" data-strategy="Breathing">Breathing</button>
          <button class="strategy-card" data-strategy="Journaling">Journaling</button>
          <button class="strategy-card" data-strategy="Exercise">Exercise</button>
          <button class="strategy-card" data-strategy="Connection">Connection</button>
          <button class="strategy-card" data-strategy="Mindfulness">Mindfulness</button>
          <button class="strategy-card" data-strategy="Help">Help</button>
        </div>
      </section>

      <!-- Journaling -->
      <section class="card" aria-labelledby="jr-title">
        <h2 id="jr-title"><span class="icon">‚úçÔ∏è</span>Journaling</h2>
        <textarea id="journalEntry" placeholder="Write your thoughts..."></textarea>
        <button id="saveJournalBtn">Save Entry</button>
        <p id="journalMessage"></p>
      </section>

      <!-- Mood Tracker -->
      <section class="card" aria-labelledby="mt-title">
        <h2 id="mt-title"><span class="icon">üòä</span>Mood Tracker</h2>
        <div class="mood-buttons" role="radiogroup">
          <button class="mood-btn" data-mood="1" aria-checked="false" role="radio">üòû</button>
          <button class="mood-btn" data-mood="2" aria-checked="false" role="radio">üòü</button>
          <button class="mood-btn" data-mood="3" aria-checked="false" role="radio">üòê</button>
          <button class="mood-btn" data-mood="4" aria-checked="false" role="radio">üôÇ</button>
          <button class="mood-btn" data-mood="5" aria-checked="false" role="radio">üòÑ</button>
        </div>
        <div class="progress-bar"><div class="progress-fill"></div></div>
        <p id="moodMessage"></p>
      </section>

      <!-- Emergency Support -->
      <section class="card emergency-section" aria-labelledby="es-title">
        <h2 id="es-title"><span class="icon">üö®</span>Emergency Support</h2>
        <p>If you or someone you know is in crisis:</p>
        <p class="emergency-number"><a href="tel:1-833-456-4566">Canada Suicide Prevention: 1-833-456-4566</a></p>
        <p><a href="https://www.crisisservicescanada.ca/en/" target="_blank">Visit Crisis Services Canada</a></p>
      </section>

      <!-- Additional Resources -->
      <section class="card" aria-labelledby="ar-title">
        <h2 id="ar-title"><span class="icon">üìö</span>Additional Resources</h2>
        <ul>
          <li><a href="https://www.griefshare.org/" target="_blank">GriefShare</a></li>
          <li><a href="https://www.cmha.ca/" target="_blank">Canadian Mental Health Assoc.</a></li>
          <li><a href="https://suicidepreventionlifeline.org/" target="_blank">US Suicide Lifeline</a></li>
          <li><a href="https://www.samhsa.gov/find-help/national-helpline" target="_blank">SAMHSA Helpline (US)</a></li>
        </ul>
      </section>

      <!-- Support Contacts -->
      <section class="card" aria-labelledby="sc-title">
        <h2 id="sc-title"><span class="icon">‚òéÔ∏è</span>Support Contacts</h2>
        <ul>
          <li><a href="https://www.suicideprevention.ca/" target="_blank">Canadian Suicide Prevention</a></li>
          <li><a href="https://www.nimh.nih.gov" target="_blank">NIMH Coping Resources</a></li>
          <li><a href="https://www.bereavedfamilies.net/" target="_blank">Bereaved Families of Ontario</a></li>
        </ul>
      </section>

    </div>
  </div>

  <!-- Modal Overlay -->
  <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h3 id="modalTitle"></h3>
      <div id="modalBody" class="modal-body"></div>
    </div>
  </div>

  <!-- Analytics Button & Panel -->
  <button id="showAnalytics" aria-label="Show analytics">üìä</button>
  <div id="analyticsPanel" role="region" aria-live="polite" style="display:none;position:fixed;bottom:80px;right:1rem;background:var(--card-bg);padding:1rem;border-radius:8px;box-shadow:0 8px 24px var(--card-shadow);max-width:280px;z-index:100;">
    <h4 style="margin-top:0;color:var(--accent);">Usage Analytics</h4>
    <ul id="analyticsList" style="padding-left:1.2rem;margin:0 0 1rem;"></ul>
    <button id="closeAnalyticsBtn" style="width:100%;">Close</button>
  </div>

  <script>
    // Theme Switcher
    const themeSelector = document.getElementById('themeSelector');
    themeSelector.addEventListener('change', e => {
      document.body.className = 'theme-' + e.target.value;
    });

    // SOS Button
    document.getElementById('sosBtn').addEventListener('click', () => {
      openModal('SOS & Grounding', `
        <p><strong>Canada Suicide Prevention Service:</strong> <a href="tel:1-833-456-4566">1-833-456-4566</a></p>
        <p><strong>Emergency:</strong> Call 911</p>
        <p><strong>Grounding:</strong></p>
        <ul><li>Name 5 things you see</li><li>Name 4 things you touch</li><li>Name 3 things you hear</li><li>Name 2 things you smell</li><li>Name 1 thing you taste</li></ul>
      `);
      incrementAnalytics('SOS');
    });

    // Modal Logic
    const modalOverlay = document.getElementById('modalOverlay');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const closeModalBtn = modalOverlay.querySelector('.modal-close');
    let lastFocus;
    function openModal(title, content) {
      lastFocus = document.activeElement;
      modalTitle.textContent = title;
      modalBody.innerHTML = content;
      modalOverlay.setAttribute('aria-hidden','false');
      modalOverlay.style.display = 'flex';
      closeModalBtn.focus();
    }
    function closeModal() {
      modalOverlay.setAttribute('aria-hidden','true');
      modalOverlay.style.display = 'none';
      if(lastFocus) lastFocus.focus();
    }
    closeModalBtn.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', e => {
      if(e.target === modalOverlay) closeModal();
    });
    document.addEventListener('keydown', e=>{ if(e.key==='Escape' && modalOverlay.style.display==='flex') closeModal(); });

    // Memory Garden
    document.getElementById('plantBtn').addEventListener('click', ()=>{
      const type = prompt('Enter tribute (e.g. üå∏ Flower):');
      if(!type) return;
      const item = document.createElement('div');
      item.className='garden-item';
      item.textContent=type;
      document.getElementById('garden').appendChild(item);
      incrementAnalytics('Plant ' + type);
    });

    // Grief-in-Body Explorer
    const spots = [
      {top:'20%',left:'50%',label:'Chest tightness'},
      {top:'50%',left:'60%',label:'Headache'},
      {top:'70%',left:'45%',label:'Stomach ache'}
    ];
    spots.forEach(s=>{
      const el=document.createElement('div');
      el.className='body-spot';
      el.style.top=s.top; el.style.left=s.left;
      el.title=s.label; el.tabIndex=0;
      el.addEventListener('click',()=>{
        openModal('Physical Sensation', `<p><strong>${s.label}:</strong> Common in grief. Try gentle breathing or warmth.</p>`);
        incrementAnalytics('Body ' + s.label);
      });
      document.getElementById('bodyMap').appendChild(el);
    });

    // Letters to Loved Ones
    const loveLetter=document.getElementById('loveLetter');
    document.getElementById('saveLetterBtn').addEventListener('click',()=>{
      localStorage.setItem('loveLetter', loveLetter.value);
      alert('Letter saved.');
      incrementAnalytics('Save Letter');
    });
    if(localStorage.getItem('loveLetter')) loveLetter.value = localStorage.getItem('loveLetter');

    // Comfort Plan Builder
    document.getElementById('savePlanBtn').addEventListener('click',()=>{
      const plan={
        call:document.getElementById('helpContact').value,
        activity:document.getElementById('soothingActivities').value,
        avoid:document.getElementById('avoidList').value,
        affirm:document.getElementById('affirmations').value
      };
      localStorage.setItem('comfortPlan', JSON.stringify(plan));
      alert('Comfort plan saved.');
      incrementAnalytics('Save Plan');
    });

    // Myth Busters Carousel
    const track=document.getElementById('mythTrack');
    const prevBtn=document.getElementById('prevMyth');
    const nextBtn=document.getElementById('nextMyth');
    let idx=0;
    function updateCarousel(){
      const w=track.children[0].offsetWidth+16;
      track.style.transform=`translateX(-${idx*w}px)`;
    }
    prevBtn.addEventListener('click',()=>{ idx=Math.max(0,idx-1); updateCarousel(); incrementAnalytics('Myth Prev'); });
    nextBtn.addEventListener('click',()=>{ idx=Math.min(track.children.length-1,idx+1); updateCarousel(); incrementAnalytics('Myth Next'); });

    // Basic Analytics
    const analyticsBtn=document.getElementById('showAnalytics');
    const analyticsPanel=document.getElementById('analyticsPanel');
    const analyticsList=document.getElementById('analyticsList');
    document.getElementById('closeAnalyticsBtn').addEventListener('click',()=>{
      analyticsPanel.style.display='none'; analyticsBtn.style.display='inline-block';
    });
    analyticsBtn.addEventListener('click',()=>{
      analyticsPanel.style.display='block'; analyticsBtn.style.display='none';
      analyticsList.innerHTML=Object.keys(analytics).length
        ? Object.entries(analytics).map(([k,v])=>`<li>${k}: ${v}</li>`).join('')
        : '<li>No interactions yet.</li>';
    });
    let analytics={};
    function incrementAnalytics(k){ analytics[k]=(analytics[k]||0)+1; }

    // Core Toolkit: Understanding Grief
    document.getElementById('openGriefModal').addEventListener('click',()=>{
      openModal('Understanding Grief', `
        <p>Grief is your natural response to loss. You may feel many emotions and physical sensations.</p>
        <p><strong>Stages:</strong> Denial, Anger, Bargaining, Depression, Acceptance.</p>
        <p>Everyone‚Äôs grief is unique‚Äîgive yourself time and permission to feel.</p>
      `); incrementAnalytics('Read Grief Info');
    });

    // Coping Strategies
    const strategies={
      Breathing:`<div class="breathing-circle"></div><p>Deep breathing: inhale 4s, hold 4s, exhale 4s. Repeat.</p>`,
      Journaling:`<p>Write daily prompts: ‚ÄúWhat helped today?‚Äù ‚ÄúWhat do I miss?‚Äù</p>`,
      Exercise:`<p>Gentle walk or stretch for 10 minutes.</p>`,
      Connection:`<p>Call a friend or join a support group online.</p>`,
      Mindfulness:`<p>Focus on the present moment with a 5-minute meditation.</p>`,
      Help:`<p>Reach out to a counselor or call crisis lines if needed.</p>`
    };
    document.querySelectorAll('.strategy-card').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const s=btn.getAttribute('data-strategy');
        openModal(s, strategies[s]||'<p>Info coming soon.</p>');
        incrementAnalytics('Strategy ' + s);
      });
    });

    // Journaling
    const journalEntry=document.getElementById('journalEntry');
    document.getElementById('saveJournalBtn').addEventListener('click',()=>{
      if(!journalEntry.value.trim()){ document.getElementById('journalMessage').textContent='Write something first.'; return; }
      localStorage.setItem('journalEntry', journalEntry.value);
      document.getElementById('journalMessage').textContent='Entry saved!';
      incrementAnalytics('Save Journal');
    });
    if(localStorage.getItem('journalEntry')) journalEntry.value=localStorage.getItem('journalEntry');

    // Mood Tracker
    const moodBtns=document.querySelectorAll('.mood-btn');
    const prog=document.querySelector('.progress-fill');
    const moodMsg=document.getElementById('moodMessage');
    const texts={1:"Very Sad",2:"Sad",3:"Neutral",4:"Happy",5:"Very Happy"};
    moodBtns.forEach((btn,i)=>{
      btn.addEventListener('click',()=>{
        moodBtns.forEach(b=>b.setAttribute('aria-checked','false'));
        btn.setAttribute('aria-checked','true');
        const val=i+1; prog.style.width=val*20+'%';
        moodMsg.textContent=texts[val];
        incrementAnalytics('Mood '+val);
      });
    });
  </script>
</body>
</html>