import React, { useState, useEffect } from 'react';
import {
  Moon,
  Sun,
  CheckCircle,
  Circle,
  Heart,
  Brain,
  Thermometer,
  Star,
  Save,
  Menu,
  X
} from 'lucide-react';

const ritualChecklist = [
  { key: 'dimLights', label: 'Dim lights 1-2 hours before bed', icon: Sun },
  { key: 'screens', label: 'Put away screens/devices', icon: Moon },
  { key: 'breathing', label: '5 minutes deep breathing', icon: Heart },
  { key: 'stretch', label: 'Gentle stretches or yoga', icon: Star },
  { key: 'journal', label: "Write down tomorrow's worries", icon: Brain },
  { key: 'gratitude', label: "List 3 things you're grateful for", icon: Heart },
  { key: 'bedroom', label: 'Prepare peaceful bedroom environment', icon: Moon },
  { key: 'meditation', label: 'Body scan or mindfulness practice', icon: Star }
];

const affirmations = [
  'My nervous system is learning to feel safe and calm.',
  'I am worthy of rest and peaceful sleep.',
  'Each night, my body remembers how to relax.',
  'I release the day’s stress with each breath.',
  'My healing happens in rest and stillness.',
  'I trust my body’s natural rhythm.',
  'Sleep is my sanctuary and restoration time.',
  'I am patient with my healing process.'
];

// Slider Component
const Slider = ({ label, value, onChange, min = 1, max = 10 }) => (
  <div className="space-y-2">
    <label className="block text-sm font-medium text-gray-300">{label}</label>
    <div className="flex items-center space-x-3">
      <span className="text-xs text-gray-500">{min}</span>
      <input
        type="range"
        min={min}
        max={max}
        value={value}
        onChange={onChange}
        className="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider"
        aria-valuemin={min}
        aria-valuemax={max}
        aria-valuenow={value}
      />
      <span className="text-xs text-gray-500">{max}</span>
      <span className="text-purple-400 font-medium w-8 text-center">{value}</span>
    </div>
  </div>
);

// Ritual Checklist Tab
const RitualTab = ({ ritualItems, onToggle }) => (
  <div className="space-y-6">
    <div className="text-center">
      <Moon className="mx-auto mb-3 text-purple-400" size={48} />
      <h2 className="text-2xl font-bold text-purple-400 mb-2">Nighttime Ritual</h2>
      <p className="text-gray-400">Complete these steps to prepare for restful sleep</p>
    </div>

    <div className="space-y-4">
      {ritualChecklist.map((item) => {
        const Icon = item.icon;
        return (
          <button
            key={item.key}
            type="button"
            onClick={() => onToggle(item.key)}
            className={`w-full text-left p-4 rounded-lg border-2 cursor-pointer transition-all flex items-center space-x-3 ${
              ritualItems[item.key]
                ? 'border-purple-500 bg-purple-900/20'
                : 'border-gray-700 bg-gray-800 hover:border-gray-600'
            }`}
            aria-pressed={ritualItems[item.key]}
          >
            {ritualItems[item.key] ? (
              <CheckCircle className="text-purple-400" size={24} aria-hidden="true" />
            ) : (
              <Circle className="text-gray-500" size={24} aria-hidden="true" />
            )}
            <Icon className="text-purple-400" size={20} aria-hidden="true" />
            <span className={`font-medium ${ritualItems[item.key] ? 'text-purple-300' : 'text-gray-300'}`}>
              {item.label}
            </span>
          </button>
        );
      })}
    </div>

    <div className="text-center">
      <p className="text-sm text-gray-400">
        {Object.values(ritualItems).filter(Boolean).length} of {ritualChecklist.length} completed
      </p>
    </div>
  </div>
);

// Daily Tracker Tab
const TrackerTab = ({ trackerEntry, setTrackerEntry, onSave }) => (
  <div className="space-y-6">
    <div className="text-center">
      <Brain className="mx-auto mb-3 text-purple-400" size={48} />
      <h2 className="text-2xl font-bold text-purple-400 mb-2">Daily Tracker</h2>
      <p className="text-gray-400">Track your energy and mood patterns</p>
    </div>

    <div className="space-y-6">
      <div>
        <label htmlFor="tracker-date" className="block text-sm font-medium text-gray-300 mb-2">
          Date
        </label>
        <input
          id="tracker-date"
          type="date"
          value={trackerEntry.date}
          onChange={(e) => setTrackerEntry({ ...trackerEntry, date: e.target.value })}
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        />
      </div>

      <Slider
        label="Energy Level"
        value={trackerEntry.energy}
        onChange={(e) => setTrackerEntry({ ...trackerEntry, energy: Number(e.target.value) })}
      />

      <Slider
        label="Mood"
        value={trackerEntry.mood}
        onChange={(e) => setTrackerEntry({ ...trackerEntry, mood: Number(e.target.value) })}
      />

      <Slider
        label="Sleep Quality (last night)"
        value={trackerEntry.sleepQuality}
        onChange={(e) => setTrackerEntry({ ...trackerEntry, sleepQuality: Number(e.target.value) })}
      />

      <div>
        <label className="flex items-center space-x-3 cursor-pointer">
          <input
            type="checkbox"
            checked={trackerEntry.wiredButBlank}
            onChange={(e) => setTrackerEntry({ ...trackerEntry, wiredButBlank: e.target.checked })}
            className="w-5 h-5 text-purple-600 bg-gray-800 border-gray-700 rounded focus:ring-purple-500"
          />
          <span className="text-gray-300">Feeling wired but blank today</span>
        </label>
      </div>

      <div>
        <label htmlFor="tracker-notes" className="block text-sm font-medium text-gray-300 mb-2">
          Notes
        </label>
        <textarea
          id="tracker-notes"
          value={trackerEntry.notes}
          onChange={(e) => setTrackerEntry({ ...trackerEntry, notes: e.target.value })}
          placeholder="How are you feeling today? Any patterns you notice?"
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent h-24 resize-none"
        />
      </div>

      <button
        onClick={onSave}
        className="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2"
      >
        <Save size={20} />
        <span>Save Daily Entry</span>
      </button>
    </div>
  </div>
);

// Impulse Journal Tab
const ImpulseTab = ({ impulseEntry, setImpulseEntry, onSave }) => (
  <div className="space-y-6">
    <div className="text-center">
      <Heart className="mx-auto mb-3 text-purple-400" size={48} />
      <h2 className="text-2xl font-bold text-purple-400 mb-2">Impulse & Emotion Journal</h2>
      <p className="text-gray-400">Capture emotional waves and coping strategies</p>
    </div>

    <div className="space-y-6">
      <div>
        <label htmlFor="impulse-trigger" className="block text-sm font-medium text-gray-300 mb-2">
          What triggered this feeling?
        </label>
        <textarea
          id="impulse-trigger"
          value={impulseEntry.trigger}
          onChange={(e) => setImpulseEntry({ ...impulseEntry, trigger: e.target.value })}
          placeholder="Describe what happened or what you were thinking about..."
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent h-20 resize-none"
        />
      </div>

      <div>
        <label htmlFor="impulse-emotion" className="block text-sm font-medium text-gray-300 mb-2">
          What emotion(s) am I feeling?
        </label>
        <input
          id="impulse-emotion"
          type="text"
          value={impulseEntry.emotion}
          onChange={(e) => setImpulseEntry({ ...impulseEntry, emotion: e.target.value })}
          placeholder="Anxious, angry, sad, numb, overwhelmed..."
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        />
      </div>

      <Slider
        label="Intensity Level"
        value={impulseEntry.intensity}
        onChange={(e) => setImpulseEntry({ ...impulseEntry, intensity: Number(e.target.value) })}
      />

      <div>
        <label htmlFor="impulse-coping" className="block text-sm font-medium text-gray-300 mb-2">
          What coping tools did I use?
        </label>
        <textarea
          id="impulse-coping"
          value={impulseEntry.coping}
          onChange={(e) => setImpulseEntry({ ...impulseEntry, coping: e.target.value })}
          placeholder="Breathing, movement, calling someone, journaling..."
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent h-20 resize-none"
        />
      </div>

      <div>
        <label htmlFor="impulse-outcome" className="block text-sm font-medium text-gray-300 mb-2">
          How did it turn out?
        </label>
        <textarea
          id="impulse-outcome"
          value={impulseEntry.outcome}
          onChange={(e) => setImpulseEntry({ ...impulseEntry, outcome: e.target.value })}
          placeholder="What happened next? How do you feel now?"
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent h-20 resize-none"
        />
      </div>

      <button
        onClick={onSave}
        className="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2"
      >
        <Save size={20} />
        <span>Save Journal Entry</span>
      </button>
    </div>
  </div>
);

// Body Check-In Tab
const BodyTab = ({ bodyEntry, setBodyEntry, onSave }) => (
  <div className="space-y-6">
    <div className="text-center">
      <Thermometer className="mx-auto mb-3 text-purple-400" size={48} />
      <h2 className="text-2xl font-bold text-purple-400 mb-2">Body + Hormone Check-In</h2>
      <p className="text-gray-400">Monitor physical patterns and changes</p>
    </div>

    <div className="space-y-6">
      <div>
        <label htmlFor="body-date" className="block text-sm font-medium text-gray-300 mb-2">
          Date
        </label>
        <input
          id="body-date"
          type="date"
          value={bodyEntry.date}
          onChange={(e) => setBodyEntry({ ...bodyEntry, date: e.target.value })}
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        />
      </div>

      <Slider
        label="Appetite"
        value={bodyEntry.appetite}
        onChange={(e) => setBodyEntry({ ...bodyEntry, appetite: Number(e.target.value) })}
      />

      <Slider
        label="Digestion"
        value={bodyEntry.digestion}
        onChange={(e) => setBodyEntry({ ...bodyEntry, digestion: Number(e.target.value) })}
      />

      <Slider
        label="Energy Level"
        value={bodyEntry.energyLevel}
        onChange={(e) => setBodyEntry({ ...bodyEntry, energyLevel: Number(e.target.value) })}
      />

      <div>
        <label htmlFor="body-temperature" className="block text-sm font-medium text-gray-300 mb-2">
          Temperature
        </label>
        <select
          id="body-temperature"
          value={bodyEntry.temperature}
          onChange={(e) => setBodyEntry({ ...bodyEntry, temperature: e.target.value })}
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        >
          <option value="cold">Always cold</option>
          <option value="normal">Normal</option>
          <option value="hot">Always hot</option>
          <option value="fluctuating">Fluctuating</option>
        </select>
      </div>

      <div>
        <label htmlFor="body-menstrualPhase" className="block text-sm font-medium text-gray-300 mb-2">
          Menstrual Phase (if applicable)
        </label>
        <select
          id="body-menstrualPhase"
          value={bodyEntry.menstrualPhase}
          onChange={(e) => setBodyEntry({ ...bodyEntry, menstrualPhase: e.target.value })}
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        >
          <option value="">Select phase</option>
          <option value="menstrual">Menstrual (Days 1-5)</option>
          <option value="follicular">Follicular (Days 6-14)</option>
          <option value="ovulatory">Ovulatory (Days 15-17)</option>
          <option value="luteal">Luteal (Days 18-28)</option>
          <option value="na">Not applicable</option>
        </select>
      </div>

      <div>
        <label htmlFor="body-physicalSymptoms" className="block text-sm font-medium text-gray-300 mb-2">
          Physical Symptoms
        </label>
        <textarea
          id="body-physicalSymptoms"
          value={bodyEntry.physicalSymptoms}
          onChange={(e) => setBodyEntry({ ...bodyEntry, physicalSymptoms: e.target.value })}
          placeholder="Headaches, tension, aches, fatigue, etc."
          className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent h-20 resize-none"
        />
      </div>

      <button
        onClick={onSave}
        className="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2"
      >
        <Save size={20} />
        <span>Save Body Check-In</span>
      </button>
    </div>
  </div>
);

// Affirmations Tab
const AffirmationsTab = () => (
  <div className="space-y-6">
    <div className="text-center">
      <Star className="mx-auto mb-3 text-purple-400" size={48} />
      <h2 className="text-2xl font-bold text-purple-400 mb-2">Healing Affirmations</h2>
      <p className="text-gray-400">Gentle reminders for your healing journey</p>
    </div>

    <div className="space-y-4">
      {affirmations.map((affirmation, index) => (
        <div
          key={index}
          className="p-4 bg-gradient-to-r from-purple-900/20 to-pink-900/20 border border-purple-500/20 rounded-lg"
        >
          <p className="text-gray-200 text-center italic">"{affirmation}"</p>
        </div>
      ))}
    </div>

    <div className="text-center">
      <p className="text-sm text-gray-400">Read these whenever you need encouragement or grounding</p>
    </div>
  </div>
);

const TabButton = ({ label, isActive, onClick }) => (
  <button
    type="button"
    onClick={onClick}
    className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
      isActive ? 'bg-purple-600 text-white shadow-lg' : 'bg-gray-800 text-gray-300 hover:bg-gray-700'
    }`}
  >
    {label}
  </button>
);

const SleepResetKit = () => {
  const [activeTab, setActiveTab] = useState('ritual');
  const [isMenuOpen, setIsMenuOpen] = useState(false);

  // Ritual checklist state
  const [ritualItems, setRitualItems] = useState({
    dimLights: false,
    screens: false,
    breathing: false,
    stretch: false,
    journal: false,
    gratitude: false,
    bedroom: false,
    meditation: false
  });

  // Tracker state
  const [trackerEntry, setTrackerEntry] = useState({
    date: new Date().toISOString().substring(0, 10),
    energy: 5,
    mood: 5,
    sleepQuality: 5,
    wiredButBlank: false,
    notes: ''
  });

  // Impulse journal state
  const [impulseEntry, setImpulseEntry] = useState({
    trigger: '',
    emotion: '',
    intensity: 5,
    coping: '',
    outcome: ''
  });

  // Body check-in state
  const [bodyEntry, setBodyEntry] = useState({
    date: new Date().toISOString().substring(0, 10),
    appetite: 5,
    digestion: 5,
    energyLevel: 5,
    temperature: 'normal',
    menstrualPhase: '',
    physicalSymptoms: ''
  });

  // Load saved data from localStorage on mount
  useEffect(() => {
    const savedRitual = JSON.parse(localStorage.getItem('ritual'));
    if (savedRitual) setRitualItems(savedRitual);

    const savedTracker = JSON.parse(localStorage.getItem('tracker'));
    if (savedTracker) setTrackerEntry(savedTracker);

    const savedImpulse = JSON.parse(localStorage.getItem('impulse'));
    if (savedImpulse) setImpulseEntry(savedImpulse);

    const savedBody = JSON.parse(localStorage.getItem('body'));
    if (savedBody) setBodyEntry(savedBody);
  }, []);

  // Save functions
  const saveRitual = () => {
    localStorage.setItem('ritual', JSON.stringify(ritualItems));
    alert('Ritual checklist saved!');
  };

  const saveTracker = () => {
    localStorage.setItem('tracker', JSON.stringify(trackerEntry));
    alert('Daily tracker saved!');
  };

  const saveImpulse = () => {
    localStorage.setItem('impulse', JSON.stringify(impulseEntry));
    alert('Impulse journal saved!');
  };

  const saveBody = () => {
    localStorage.setItem('body', JSON.stringify(bodyEntry));
    alert('Body check-in saved!');
  };

  // Toggle ritual checklist item
  const toggleRitualItem = (key) => {
    setRitualItems((prev) => {
      const updated = { ...prev, [key]: !prev[key] };
      localStorage.setItem('ritual', JSON.stringify(updated));
      return updated;
    });
  };

  return (
    <div className="max-w-md mx-auto min-h-screen bg-gray-900 text-gray-100 p-4 flex flex-col">
      {/* Header */}
      <header className="flex justify-between items-center mb-4">
        <h1 className="text-3xl font-extrabold text-purple-400">Sleep Reset Kit</h1>
        <button
          onClick={() => setIsMenuOpen(!isMenuOpen)}
          aria-label={isMenuOpen ? 'Close menu' : 'Open menu'}
          className="text-purple-400 hover:text-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 rounded"
        >
          {isMenuOpen ? <X size={32} /> : <Menu size={32} />}
        </button>
      </header>

      {/* Tabs Menu */}
      {isMenuOpen && (
        <nav className="mb-6 flex flex-wrap justify-center gap-3">
          <TabButton
            label="Nighttime Ritual"
            isActive={activeTab === 'ritual'}
            onClick={() => {
              setActiveTab('ritual');
              setIsMenuOpen(false);
            }}
          />
          <TabButton
            label="Daily Tracker"
            isActive={activeTab === 'tracker'}
            onClick={() => {
              setActiveTab('tracker');
              setIsMenuOpen(false);
            }}
          />
          <TabButton
            label="Impulse Journal"
            isActive={activeTab === 'impulse'}
            onClick={() => {
              setActiveTab('impulse');
              setIsMenuOpen(false);
            }}
          />
          <TabButton
            label="Body Check-In"
            isActive={activeTab === 'body'}
            onClick={() => {
              setActiveTab('body');
              setIsMenuOpen(false);
            }}
          />
          <TabButton
            label="Affirmations"
            isActive={activeTab === 'affirmations'}
            onClick={() => {
              setActiveTab('affirmations');
              setIsMenuOpen(false);
            }}
          />
        </nav>
      )}

      {/* Main Content */}
      <main className="flex-1 overflow-auto">
        {activeTab === 'ritual' && <RitualTab ritualItems={ritualItems} onToggle={toggleRitualItem} />}
        {activeTab === 'tracker' && (
          <TrackerTab trackerEntry={trackerEntry} setTrackerEntry={setTrackerEntry} onSave={saveTracker} />
        )}
        {activeTab === 'impulse' && (
          <ImpulseTab impulseEntry={impulseEntry} setImpulseEntry={setImpulseEntry} onSave={saveImpulse} />
        )}
        {activeTab === 'body' && (
          <BodyTab bodyEntry={bodyEntry} setBodyEntry={setBodyEntry} onSave={saveBody} />
        )}
        {activeTab === 'affirmations' && <AffirmationsTab />}
      </main>
    </div>
  );
};

export default SleepResetKit;