<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grounding Wheel</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #222831, #393e46);
      color: #eeeeee;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    h1 {
      margin-bottom: 20px;
      color: #00adb5;
    }

    #spinner {
      position: relative;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 8px solid #00adb5;
      overflow: hidden;
      margin-bottom: 30px;
      transition: transform 5s cubic-bezier(0.33, 1, 0.68, 1);
    }

    canvas {
      width: 100%;
      height: 100%;
    }

    .arrow {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid #ffcc00;
      z-index: 10;
    }

    button {
      padding: 12px 24px;
      font-size: 18px;
      background: #00adb5;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #393e46;
      color: #eeeeee;
      padding: 25px 30px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      z-index: 20;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 15;
    }
  </style>
</head>
<body>

<h1>Spin the Grounding Wheel</h1>

<div class="arrow"></div>
<div id="spinner">
  <canvas id="wheelCanvas" width="300" height="300"></canvas>
</div>
<button id="spinBtn">Spin</button>

<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
  <h2 id="techniqueTitle"></h2>
  <p id="techniqueDesc"></p>
</div>

<script>
  const techniques = [
    { title: "5-4-3-2-1 Method", desc: "Name 5 things you see, 4 things you feel, 3 things you hear, 2 things you smell, and 1 thing you taste." },
    { title: "Deep Breathing", desc: "Inhale for 4 seconds, hold for 7, and exhale for 8. Repeat slowly." },
    { title: "Hold an Ice Cube", desc: "Feel its coldness and focus entirely on the sensation." },
    { title: "Stretch", desc: "Do a gentle full-body stretch to ground yourself physically." },
    { title: "Name 5 Colors", desc: "Look around and name 5 colors you can see." },
    { title: "Touch an Object", desc: "Pick up something near you and describe its texture in detail." },
    { title: "Listen Closely", desc: "Close your eyes and try to identify 3 distant sounds." },
    { title: "Drink Water Slowly", desc: "Take a sip and focus fully on how it feels." },
  ];

  const canvas = document.getElementById("wheelCanvas");
  const ctx = canvas.getContext("2d");
  const spinner = document.getElementById("spinner");
  const spinBtn = document.getElementById("spinBtn");
  const popup = document.getElementById("popup");
  const overlay = document.getElementById("overlay");
  const title = document.getElementById("techniqueTitle");
  const desc = document.getElementById("techniqueDesc");

  const total = techniques.length;
  const sliceAngle = (2 * Math.PI) / total;
  let currentRotation = 0;
  let spinning = false;

  function drawWheel() {
    const colors = ["#00adb5", "#007880"];
    for (let i = 0; i < total; i++) {
      const start = i * sliceAngle;
      const end = start + sliceAngle;

      ctx.beginPath();
      ctx.moveTo(150, 150);
      ctx.arc(150, 150, 140, start, end);
      ctx.closePath();
      ctx.fillStyle = colors[i % 2];
      ctx.fill();

      ctx.save();
      ctx.translate(150, 150);
      ctx.rotate(start + sliceAngle / 2);
      ctx.fillStyle = "#eeeeee";
      ctx.font = "bold 12px sans-serif";
      ctx.textAlign = "right";
      ctx.fillText(techniques[i].title, 130, 5);
      ctx.restore();
    }

    // Draw center circle
    ctx.beginPath();
    ctx.arc(150, 150, 30, 0, 2 * Math.PI);
    ctx.fillStyle = "#393e46";
    ctx.fill();
  }

  drawWheel();

  function spinWheel() {
    if (spinning) return;
    spinning = true;
    spinBtn.disabled = true;

    const randIndex = Math.floor(Math.random() * total);
    const randOffset = Math.random() * sliceAngle;
    const totalSpin = 360 * 5 + ((2 * Math.PI * randIndex + randOffset) * 180 / Math.PI);
    const duration = 5000;
    const start = performance.now();

    function animate(now) {
      const elapsed = now - start;
      const ease = 1 - Math.pow(1 - elapsed / duration, 3);
      currentRotation = ease * totalSpin;
      spinner.style.transform = `rotate(${currentRotation}deg)`;

      if (elapsed < duration) {
        requestAnimationFrame(animate);
      } else {
        spinning = false;
        spinBtn.disabled = false;
        showPopup(randIndex);
      }
    }

    requestAnimationFrame(animate);
  }

  function showPopup(index) {
    title.textContent = techniques[index].title;
    desc.textContent = techniques[index].desc;
    popup.style.display = "block";
    overlay.style.display = "block";
  }

  function closePopup() {
    popup.style.display = "none";
    overlay.style.display = "none";
  }

  spinBtn.addEventListener("click", spinWheel);
  overlay.addEventListener("click", closePopup);
</script>

</body>
</html>