<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sleep Game Spinner - 30 Sections with Center Arrow</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #282c34;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
  }
  #spinner-container {
    position: relative;
    width: 320px;
    height: 320px;
  }
  #spinner {
    width: 320px;
    height: 320px;
    border-radius: 50%;
    position: relative;
    overflow: visible;
    cursor: pointer;
    user-select: none;
  }
  canvas {
    border-radius: 50%;
  }
  /* Center arrow pointer inside spinner */
  #center-arrow {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    margin-left: -12px;
    margin-top: -140px; /* Push arrow outward from center */
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-bottom: 24px solid #ffcc00;
    filter: drop-shadow(0 0 3px #ffd700);
    pointer-events: none; /* So it doesn't block clicks */
    z-index: 10;
    transform-origin: 50% 100%;
  }
  button#spinBtn {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    background: #ffcc00;
    color: #282c34;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 0 8px #ffd700;
    transition: background 0.3s ease;
  }
  button#spinBtn:disabled {
    background: #bbb;
    cursor: not-allowed;
    box-shadow: none;
  }
  /* Popup styles */
  #overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    z-index: 1000;
  }
  #popup {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 320px;
    max-width: 90vw;
    background: #1e1e1e;
    border-radius: 12px;
    padding: 20px;
    color: #eee;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 20px #ffcc00;
    display: none;
    z-index: 1001;
  }
  #popup img {
    width: 100%;
    border-radius: 8px;
    margin-bottom: 12px;
  }
  #popup h2 {
    margin: 0 0 12px 0;
    font-size: 24px;
    text-align: center;
  }
  #popup p {
    font-size: 16px;
    white-space: pre-line;
  }
</style>
</head>
<body>

<div id="spinner-container">
  <div id="spinner" aria-label="Sleep Game Spinner" role="listbox" tabindex="0"></div>
  <div id="center-arrow" aria-hidden="true"></div>
</div>

<button id="spinBtn" aria-live="polite">Spin the Wheel</button>

<div id="overlay" tabindex="-1"></div>
<div id="popup" role="dialog" aria-modal="true" aria-labelledby="gameTitle" aria-describedby="gameDesc" tabindex="0">
  <h2 id="gameTitle"></h2>
  <img id="gameImage" src="" alt="" />
  <p id="gameDesc"></p>
</div>

<script>
  const games = [
    {title: "🛌 5-4-3-2-1", desc: "Name 5 things you see, 4 you hear, 3 you feel, 2 you smell, 1 you taste to relax.", image: "https://cdn-icons-png.flaticon.com/512/616/616541.png", alt: "Counting senses"},
    {title: "🌙 Breath Focus", desc: "Breathe deeply and slowly, count to 4 on inhale, hold 4, exhale 6. Repeat.", image: "https://cdn-icons-png.flaticon.com/512/616/616494.png", alt: "Deep breath"},
    {title: "🌌 Star Gazing", desc: "Imagine a peaceful night sky full of stars, feel calm and cozy.", image: "https://cdn-icons-png.flaticon.com/512/616/616510.png", alt: "Starry night"},
    {title: "📖 Storytime", desc: "Think of a favorite calming story or make one up in your mind.", image: "https://cdn-icons-png.flaticon.com/512/616/616409.png", alt: "Open book"},
    {title: "🖌️ Doodle Draw", desc: "Draw simple shapes or patterns to relax your mind.", image: "https://cdn-icons-png.flaticon.com/512/616/616422.png", alt: "Pencil and doodles"},
    {title: "🌿 Nature Sounds", desc: "Imagine gentle nature sounds like rain or wind chimes.", image: "https://cdn-icons-png.flaticon.com/512/616/616519.png", alt: "Wind chimes"},
    {title: "🌟 Glow Fireflies", desc: "Picture soft glowing fireflies flickering gently.", image: "https://cdn-icons-png.flaticon.com/512/616/616456.png", alt: "Fireflies glowing"},
    {title: "🛋️ Cozy Corner", desc: "Visualize a cozy reading corner with soft cushions and blanket.", image: "https://cdn-icons-png.flaticon.com/512/3181/3181957.png", alt: "Cozy chair"},
    {title: "🍵 Tea Time", desc: "Imagine sipping warm herbal tea, feeling warmth inside.", image: "https://cdn-icons-png.flaticon.com/512/3017/3017893.png", alt: "Cup of tea"},
    {title: "🌄 Sunrise Calm", desc: "Picture a peaceful sunrise bringing gentle peace.", image: "https://cdn-icons-png.flaticon.com/512/869/869869.png", alt: "Sunrise"},
    {title: "🐾 Soft Steps", desc: "Imagine soft footsteps on a forest path calming your mind.", image: "https://cdn-icons-png.flaticon.com/512/616/616449.png", alt: "Footsteps"},
    {title: "🎶 Gentle Music", desc: "Imagine soft, slow music playing in the background.", image: "https://cdn-icons-png.flaticon.com/512/616/616561.png", alt: "Music notes"},
    {title: "🕯️ Candle Glow", desc: "Visualize a softly glowing candle flame.", image: "https://cdn-icons-png.flaticon.com/512/616/616479.png", alt: "Candle flame"},
    {title: "🌊 Ocean Waves", desc: "Imagine gentle waves rolling onto the shore.", image: "https://cdn-icons-png.flaticon.com/512/616/616470.png", alt: "Ocean waves"},
    {title: "🌸 Flower Bloom", desc: "Picture a flower slowly blooming with soft colors.", image: "https://cdn-icons-png.flaticon.com/512/616/616462.png", alt: "Flower blooming"},
    {title: "🧘 Meditation", desc: "Focus on your breath and body sensations calmly.", image: "https://cdn-icons-png.flaticon.com/512/616/616549.png", alt: "Meditation pose"},
    {title: "🐦 Bird Song", desc: "Imagine soft bird songs in a quiet forest.", image: "https://cdn-icons-png.flaticon.com/512/616/616504.png", alt: "Bird singing"},
    {title: "🌈 Color Splash", desc: "Think of your favorite calming colors flowing gently.", image: "https://cdn-icons-png.flaticon.com/512/616/616537.png", alt: "Colors splash"},
    {title: "💤 Sleepy Clouds", desc: "Picture soft fluffy clouds drifting slowly.", image: "https://cdn-icons-png.flaticon.com/512/616/616460.png", alt: "Fluffy clouds"},
    {title: "🐠 Fish Swim", desc: "Imagine colorful fish swimming calmly underwater.", image: "https://cdn-icons-png.flaticon.com/512/616/616487.png", alt: "Fish swimming"},
    {title: "🍂 Autumn Leaves", desc: "Picture leaves gently falling on a quiet path.", image: "https://cdn-icons-png.flaticon.com/512/616/616464.png", alt: "Falling leaves"},
    {title: "🏞️ Quiet Lake", desc: "Imagine a still lake reflecting the sky perfectly.", image: "https://cdn-icons-png.flaticon.com/512/616/616513.png", alt: "Quiet lake"},
    {title: "🌬️ Gentle Breeze", desc: "Feel a soft breeze brushing your face lightly.", image: "https://cdn-icons-png.flaticon.com/512/616/616520.png", alt: "Gentle breeze"},
    {title: "🍫 Chocolate Treat", desc: "Imagine enjoying a small piece of smooth chocolate.", image: "https://cdn-icons-png.flaticon.com/512/616/616545.png", alt: "Chocolate"},
    {title: "🌜 Moonlight", desc: "Picture gentle moonlight bathing a calm night.", image: "https://cdn-icons-png.flaticon.com/512/616/616477.png", alt: "Moonlight"},
    {title: "🍯 Honey Spoons", desc: "Imagine sweet honey dripping slowly on your tongue.", image: "https://cdn-icons-png.flaticon.com/512/616/616533.png", alt: "Honey spoon"},
    {title: "🛏️ Soft Pillows", desc: "Visualize sinking into soft, fluffy pillows.", image: "https://cdn-icons-png.flaticon.com/512/616/616523.png", alt: "Soft pillows"},
    {title: "🎈 Balloon Rise", desc: "Imagine colorful balloons floating gently upward.", image: "https://cdn-icons-png.flaticon.com/512/616/616548.png", alt: "Balloons rising"},
    {title: "🐝 Buzzing Bee", desc: "Picture a calm bee gently buzzing nearby.", image: "https://cdn-icons-png.flaticon.com/512/616/616535.png", alt: "Bee buzzing"},
    {title: "🕊️ Peace Dove", desc: "Imagine a white dove soaring peacefully.", image: "https://cdn-icons-png.flaticon.com/512/616/616506.png", alt: "Peace dove"}
  ];

  const spinner = document.getElementById("spinner");
  const spinBtn = document.getElementById("spinBtn");
  const popup = document.getElementById("popup");
  const overlay = document.getElementById("overlay");
  const gameTitle = document.getElementById("gameTitle");
  const gameDesc = document.getElementById("gameDesc");
  const gameImage = document.getElementById("gameImage");
  const centerArrow = document.getElementById("center-arrow");

  let spinning = false;
  let currentRotation = 0;
  const slices = games.length;
  const degreesPerSlice = 360 / slices;

  // Draw spinner segments on canvas
  function drawSpinner() {
    const canvas = document.createElement("canvas");
    canvas.width = 320;
    canvas.height = 320;
    canvas.setAttribute("aria-hidden", "true");
    spinner.appendChild(canvas);

    const ctx = canvas.getContext("2d");
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 150;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (let i = 0; i < slices; i++) {
      const startAngle = (i * 2 * Math.PI) / slices - Math.PI / 2;
      const endAngle = ((i + 1) * 2 * Math.PI) / slices - Math.PI / 2;

      // Alternate colors for slices
      ctx.fillStyle = i % 2 === 0 ? "#444" : "#666";
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, startAngle, endAngle);
      ctx.closePath();
      ctx.fill();

      // Draw slice text (title)
      ctx.save();
      ctx.fillStyle = "#ffd700";
      ctx.translate(centerX, centerY);
      const angle = startAngle + (endAngle - startAngle) / 2;
      ctx.rotate(angle);
      ctx.textAlign = "right";
      ctx.font = "14px 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
      ctx.fillText(games[i].title, radius - 10, 5);
      ctx.restore();
    }

    // Draw center circle to cover slice edges
    ctx.beginPath();
    ctx.fillStyle = "#282c34";
    ctx.arc(centerX, centerY, 40, 0, 2 * Math.PI);
    ctx.fill();
  }

  drawSpinner();

  // Spin logic
  function spinWheel() {
    if (spinning) return;

    spinning = true;
    spinBtn.disabled = true;

    // Calculate random spin: at least 5 full rotations + random slice
    const randomSlice = Math.floor(Math.random() * slices);
    const extraDegrees = Math.random() * degreesPerSlice;
    const totalDegrees = 360 * 5 + (360 - (randomSlice * degreesPerSlice + extraDegrees));

    const duration = 5000; // spin duration in ms
    const start = performance.now();

    function animate(now) {
      const elapsed = now - start;
      if (elapsed < duration) {
        const easeOut = 1 - Math.pow(1 - elapsed / duration, 3);
        currentRotation = easeOut * totalDegrees;
        spinner.style.transform = `rotate(${currentRotation}deg)`;
        requestAnimationFrame(animate);
      } else {
        // Finish at exact rotation
        currentRotation = totalDegrees;
        spinner.style.transform = `rotate(${currentRotation}deg)`;
        spinning = false;
        spinBtn.disabled = false;

        // Calculate winning index
        let normalizedRotation = currentRotation % 360;
        // The arrow points up (at -90deg), so adjust accordingly
        let winningIndex = Math.floor(((360 - (normalizedRotation + 90)) % 360) / degreesPerSlice);
        showPopup(winningIndex);
      }
    }

    requestAnimationFrame(animate);
  }

  function showPopup(index) {
    const game = games[index];
    gameTitle.textContent = game.title;
    gameDesc.textContent = game.desc;
    gameImage.src = game.image;
    gameImage.alt = game.alt;
    overlay.style.display = "block";
    popup.style.display = "block";
    popup.focus();
  }

  function closePopup() {
    overlay.style.display = "none";
    popup.style.display = "none";
  }

  spinBtn.addEventListener("click", spinWheel);
  overlay.addEventListener("click", closePopup);
  popup.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closePopup();
      spinBtn.focus();
    }
  });

  // Accessibility: allow keyboard spin
  spinner.addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " ") {
      spinWheel();
    }
  });
</script>
</body>
</html>