<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Grounding Toolkit</title>
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: linear-gradient(135deg, #bfdbfe 0%, #c4b5fd 100%);
    margin: 0;
    padding: 2rem 1rem;
    color: #334155;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    font-weight: 800;
    font-size: 2.5rem;
    margin-bottom: 0.25rem;
  }
  h2 {
    font-size: 1.5rem;
    margin: 0 0 1rem 0;
  }
  p {
    line-height: 1.5;
  }
  .heart-msg {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #ef4444;
    margin-bottom: 2rem;
    font-weight: 600;
  }
  .heart-msg span {
    font-size: 0.9rem;
  }
  .accordion {
    max-width: 700px;
    width: 100%;
  }
  .card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgb(0 0 0 / 0.1);
    margin-bottom: 1rem;
    overflow: hidden;
    border: 2px solid #e2e8f0;
    cursor: pointer;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  .card.active {
    border-color: #3b82f6;
    box-shadow: 0 4px 14px rgb(59 130 246 / 0.3);
    cursor: default;
  }
  .card-header {
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .card-header .icon {
    font-size: 1.8rem;
  }
  .card-header h3 {
    font-weight: 700;
    font-size: 1.25rem;
    margin: 0;
    flex-grow: 1;
    color: #1e40af;
  }
  .card-header .status {
    font-size: 0.9rem;
    color: #64748b;
    user-select: none;
  }
  .card-content {
    padding: 1rem 2rem 2rem 2rem;
    display: none;
    animation: fadeIn 0.5s ease forwards;
    color: #334155;
  }
  .card-content.active {
    display: block;
  }
  button {
    background-color: #3b82f6;
    border: none;
    color: white;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  button:hover:not(:disabled) {
    background-color: #2563eb;
  }
  button:disabled {
    background-color: #94a3b8;
    cursor: default;
  }
  .nav-button {
    margin-top: 1rem;
    background-color: #64748b;
  }
  .nav-button:hover {
    background-color: #475569;
  }
  .center-text {
    text-align: center;
  }
  .count-large {
    font-size: 4rem;
    font-weight: 700;
    margin: 0.5rem 0;
    color: #2563eb;
  }
  .prompt {
    font-style: italic;
    margin: 1rem 0 2rem 0;
    color: #475569;
  }
  .muscle-step {
    font-size: 1.1rem;
    font-weight: 500;
    margin: 1rem 0 2rem 0;
    color: #7c3aed;
  }
  .box-breathing-box {
    width: 120px;
    height: 120px;
    margin: 1rem auto 2rem;
    border: 4px solid #22c55e;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.5rem;
    color: #15803d;
    position: relative;
    overflow: hidden;
  }
  .box-fill {
    position: absolute;
    inset: 8px;
    background-color: #bbf7d0;
    border-radius: 12px;
    opacity: 0;
    transition: opacity 0.5s ease;
  }
  .box-fill.active {
    opacity: 1;
  }
  .breathing-circle {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    border: 4px solid #14b8a6;
    margin: 1rem auto 2rem;
    position: relative;
    overflow: hidden;
  }
  .breath-fill {
    position: absolute;
    inset: 0;
    background-color: #5eead4;
    border-radius: 50%;
    transform: scale(0);
    transition: transform 4s ease;
  }
  .breath-fill.inhale {
    transform: scale(1);
  }
  .breath-fill.exhale {
    transform: scale(0);
    transition-duration: 6000ms;
  }
  .breathing-text {
    position: relative;
    z-index: 1;
    text-align: center;
    color: #0f766e;
    font-weight: 700;
    font-size: 1.5rem;
    text-transform: capitalize;
  }
  .footer-note {
    max-width: 700px;
    margin-top: 3rem;
    background: white;
    border-radius: 12px;
    padding: 1rem 2rem;
    box-shadow: 0 2px 10px rgb(0 0 0 / 0.1);
    color: #475569;
    font-size: 0.9rem;
    text-align: center;
  }
  @keyframes fadeIn {
    from {opacity: 0;}
    to {opacity: 1;}
  }
</style>
</head>
<body>

<h1 class="center-text">Grounding Toolkit</h1>
<div class="heart-msg">
  <span>‚ù§Ô∏è</span>
  <span>You are safe. You are here. You are enough.</span>
</div>

<div class="accordion" id="accordion">

  <!-- Cards will be injected here by JS -->

</div>

<div class="footer-note">
  <strong>Remember:</strong> Grounding takes practice. Be patient and gentle with yourself.<br />
  If you're in crisis, please reach out to a mental health professional or crisis hotline.
</div>

<script>
(() => {
  // Exercises data

  const fiveToOneSteps = [
    { count: 5, sense: "things you can SEE", icon: "üëÄ", prompt: "Look around and name 5 things you can see‚Ä¶" },
    { count: 4, sense: "things you can TOUCH", icon: "‚úã", prompt: "Notice 4 things you can touch or feel‚Ä¶" },
    { count: 3, sense: "things you can HEAR", icon: "üëÇ", prompt: "Listen for 3 sounds around you‚Ä¶" },
    { count: 2, sense: "things you can SMELL", icon: "üëÉ", prompt: "Take a breath and notice 2 scents‚Ä¶" },
    { count: 1, sense: "thing you can TASTE", icon: "üëÖ", prompt: "Notice 1 taste in your mouth‚Ä¶" }
  ];

  const muscleGroups = [
    "Tense your toes and feet for 5 seconds, then release‚Ä¶",
    "Tighten your calf muscles, hold, then let go‚Ä¶",
    "Squeeze your thigh muscles, hold, then relax‚Ä¶",
    "Clench your fists, hold tight, then release‚Ä¶",
    "Tense your arm muscles, hold, then let them go‚Ä¶",
    "Scrunch your shoulders up to your ears, then drop them‚Ä¶",
    "Tighten your face muscles, hold, then soften‚Ä¶",
    "Take a deep breath and notice the relaxation in your whole body‚Ä¶"
  ];

  const boxBreathingPhases = ["Inhale", "Hold", "Exhale", "Hold"];

  // State for each exercise
  const state = {
    activeExercise: null,
    fiveToOneStep: 0,
    muscleTensionStep: 0,
    boxBreathingPhase: 0,
    boxBreathingActive: false,
    breathingPhase: "inhale",
    breathingCount: 4,
    breathingActive: false,
  };

  // LocalStorage keys
  const STORAGE_KEY = "groundingToolkitUsage";
  // Usage structure: { yyyy-mm-dd: {exerciseId: true} }

  // Helpers
  function getToday() {
    return new Date().toISOString().slice(0,10);
  }

  function getUsage() {
    try {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
    } catch {
      return {};
    }
  }

  function setUsage(date, exerciseId) {
    const usage = getUsage();
    if (!usage[date]) usage[date] = {};
    usage[date][exerciseId] = true;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(usage));
  }

  function usedToday(exerciseId) {
    const usage = getUsage();
    const today = getToday();
    return usage[today] && usage[today][exerciseId];
  }

  // DOM Elements
  const accordion = document.getElementById("accordion");

  // Exercise definitions
  const exercises = [
    {
      id: "five-to-one",
      title: "5-4-3-2-1 Technique",
      description: "Ground yourself using all five senses",
      icon: "üåü",
      color: "#3b82f6",
      renderContent() {
        if (state.fiveToOneStep < fiveToOneSteps.length) {
          const step = fiveToOneSteps[state.fiveToOneStep];
          return `
            <div class="center-text">
              <div style="font-size:6rem;margin-bottom:0.5rem;">${step.icon}</div>
              <div class="count-large" style="color:${this.color}">${step.count}</div>
              <div style="font-size:1.5rem; color:#1e40af; margin-bottom: 1rem;">${step.sense}</div>
              <p class="prompt">${step.prompt}</p>
              <button id="five-to-one-next">${state.fiveToOneStep === fiveToOneSteps.length - 1 ? 'Complete' : 'Next'}</button>
            </div>
          `;
        } else {
          return `
            <div class="center-text">
              <div style="font-size:4rem;margin-bottom:0.5rem;">‚ú®</div>
              <h3 style="color:#15803d;">Well done!</h3>
              <p>You've successfully grounded yourself using all five senses.</p>
              <button id="five-to-one-reset">Practice Again</button>
            </div>
          `;
        }
      },
      handleClick(e) {
        if (e.target.id === "five-to-one-next") {
          if (state.fiveToOneStep < fiveToOneSteps.length -1) {
            state.fiveToOneStep++;
          } else {
            // Mark used today on completion
            setUsage(getToday(), this.id);
            state.fiveToOneStep++;
          }
          renderAccordion();
        }
        if (e.target.id === "five-to-one-reset") {
          state.fiveToOneStep = 0;
          renderAccordion();
        }
      }
    },
    {
      id: "box-breathing",
      title: "Box Breathing",
      description: "4-4-4-4 breathing pattern for calm",
      icon: "üì¶",
      color: "#22c55e",
      interval: null,
      renderContent() {
        const phase = boxBreathingPhases[state.boxBreathingPhase];
        return `
          <div class="center-text">
            <div class="box-breathing-box" aria-live="polite">
              <div class="box-fill ${state.boxBreathingActive ? "active" : ""}"></div>
              ${phase}
            </div>
            <p style="color:#166534; font-weight:600; margin-bottom:0.5rem;">
              ${state.boxBreathingActive ? phase + ' for 4 seconds' : 'Ready to begin?'}
            </p>
            <p style="font-size:0.85rem; color:#4b5563;">Inhale ‚Üí Hold ‚Üí Exhale ‚Üí Hold</p>
            <button id="box-breathing-toggle" style="background-color: ${state.boxBreathingActive ? '#dc2626' : '#22c55e'};">
              ${state.boxBreathingActive ? 'Pause' : 'Start'}
            </button>
          </div>
        `;
      },
      handleClick(e) {
        if (e.target.id === "box-breathing-toggle") {
          if (!state.boxBreathingActive) {
            this.startBreathing();
          } else {
            this.stopBreathing();
          }
          renderAccordion();
        }
      },
      startBreathing() {
        state.boxBreathingActive = true;
        this.interval = setInterval(() => {
          state.boxBreathingPhase = (state.boxBreathingPhase +1) % 4;
          renderAccordion();
        }, 4000);
      },
      stopBreathing() {
        state.boxBreathingActive = false;
        clearInterval(this.interval);
        this.interval = null;
      }
    },
    {
      id: "muscle-relaxation",
      title: "Progressive Muscle Relaxation",
      description: "Release tension throughout your body",
      icon: "üí™",
      color: "#7c3aed",
      renderContent() {
        if (state.muscleTensionStep < muscleGroups.length) {
          return `
            <div class="center-text">
              <div style="font-size:2rem; margin-bottom: 1rem;">üí™</div>
              <div style="font-weight:600; color:${this.color}; margin-bottom: 1rem;">
                Step ${state.muscleTensionStep + 1} of ${muscleGroups.length}
              </div>
              <p class="muscle-step">${muscleGroups[state.muscleTensionStep]}</p>
              <div style="display:flex; justify-content:center; gap:1rem; flex-wrap:wrap;">
                <button id="muscle-next">${state.muscleTensionStep === muscleGroups.length - 1 ? 'Complete' : 'Next'}</button>
                ${state.muscleTensionStep > 0 ? '<button id="muscle-prev" style="background:#ddd; color:#333;">Previous</button>' : ''}
              </div>
            </div>
          `;
        } else {
          return `
            <div class="center-text">
              <div style="font-size:4rem; margin-bottom:0.5rem;">üå∏</div>
              <h3 style="color:#15803d;">Relaxation Complete</h3>
              <p>Notice the feeling of relaxation throughout your body.</p>
              <button id="muscle-reset" style="background-color:${this.color};">Practice Again</button>
            </div>
          `;
        }
      },
      handleClick(e) {
        if (e.target.id === "muscle-next") {
          if (state.muscleTensionStep < muscleGroups.length - 1) {
            state.muscleTensionStep++;
          } else {
            setUsage(getToday(), this.id);
            state.muscleTensionStep++;
          }
          renderAccordion();
        }
        if (e.target.id === "muscle-prev") {
          if (state.muscleTensionStep > 0) {
            state.muscleTensionStep--;
          }
          renderAccordion();
        }
        if (e.target.id === "muscle-reset") {
          state.muscleTensionStep = 0;
          renderAccordion();
        }
      }
    },
    {
      id: "breathing",
      title: "4-6 Calming Breath",
      description: "Calming breath work for anxiety",
      icon: "ü´Å",
      color: "#14b8a6",
      breathingInterval: null,
      renderContent() {
        const phase = state.breathingPhase;
        const count = state.breathingCount;
        return `
          <div class="center-text">
            <div class="breathing-circle" aria-live="polite" aria-atomic="true">
              <div class="breath-fill ${state.breathingActive ? phase : ''}"></div>
              <div class="breathing-text">
                <div>${phase}</div>
                <div style="font-size:1.25rem; font-weight:600;">${count}</div>
              </div>
            </div>
            <p style="color:#0f766e; font-weight:600; margin-bottom:0.5rem;">
              ${state.breathingActive ? `${phase} for ${count} seconds` : 'Ready to breathe together?'}
            </p>
            <p style="font-size:0.85rem; color:#4b5563;">Longer exhales help activate your parasympathetic nervous system</p>
            <button id="breathing-toggle" style="background-color: ${state.breathingActive ? '#dc2626' : '#14b8a6'};">
              ${state.breathingActive ? 'Pause' : 'Start Breathing'}
            </button>
          </div>
        `;
      },
      handleClick(e) {
        if (e.target.id === "breathing-toggle") {
          if (!state.breathingActive) {
            this.startBreathing();
          } else {
            this.stopBreathing();
          }
          renderAccordion();
        }
      },
      startBreathing() {
        state.breathingActive = true;
        state.breathingPhase = "inhale";
        state.breathingCount = 4;
        this.breathingInterval = setInterval(() => {
          if (state.breathingCount === 1) {
            state.breathingPhase = state.breathingPhase === "inhale" ? "exhale" : "inhale";
            state.breathingCount = state.breathingPhase === "inhale" ? 4 : 6;
          } else {
            state.breathingCount--;
          }
          renderAccordion();
        }, 1000);
      },
      stopBreathing() {
        state.breathingActive = false;
        clearInterval(this.breathingInterval);
        this.breathingInterval = null;
        renderAccordion();
      }
    }
  ];

  // Render all cards with content (only active shows content)
  function renderAccordion() {
    accordion.innerHTML = "";

    exercises.forEach(exercise => {
      const isActive = state.activeExercise === exercise.id;
      const used = usedToday(exercise.id);
      const card = document.createElement("div");
      card.className = "card" + (isActive ? " active" : "");
      card.style.borderColor = isActive ? exercise.color : "";
      card.style.boxShadow = isActive ? `0 4px 14px ${exercise.color}66` : "";

      card.innerHTML = `
        <div class="card-header" role="button" aria-expanded="${isActive}" tabindex="0" data-id="${exercise.id}">
          <div class="icon">${exercise.icon}</div>
          <h3>${exercise.title}</h3>
          <div class="status">${used ? "‚úÖ Used Today" : ""}</div>
        </div>
        <div class="card-content ${isActive ? "active" : ""}">${isActive ? exercise.renderContent() : ""}</div>
      `;

      accordion.appendChild(card);
    });
  }

  // Handle clicks on the accordion
  accordion.addEventListener("click", (e) => {
    const header = e.target.closest(".card-header");
    if (!header) return;

    const id = header.getAttribute("data-id");

    // If clicked on the same active exercise, close it
    if (state.activeExercise === id) {
      // Also stop breathing intervals if any
      stopAnyRunningBreathing();

      state.activeExercise = null;
      renderAccordion();
      return;
    }

    // Stop any running breathing intervals first
    stopAnyRunningBreathing();

    // Open new exercise
    state.activeExercise = id;

    renderAccordion();
  });

  // Handle button clicks inside active cards
  accordion.addEventListener("click", (e) => {
    if (!state.activeExercise) return;

    const currentExercise = exercises.find(ex => ex.id === state.activeExercise);
    if (!currentExercise) return;

    currentExercise.handleClick(e);
  });

  // Stop breathing intervals when switching exercises
  function stopAnyRunningBreathing() {
    const boxBreath = exercises.find(ex => ex.id === "box-breathing");
    if (boxBreath && boxBreath.boxBreathingActive) {
      boxBreath.stopBreathing();
    }
    const breath = exercises.find(ex => ex.id === "breathing");
    if (breath && breath.breathingActive) {
      breath.stopBreathing();
    }
  }

  // Initial render
  renderAccordion();
})();
</script>
</body>
</html>