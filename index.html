<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>On 'Em ‚Äì Lobster Fishing Game</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: url('https://i.imgur.com/yH1CTBr.jpg') no-repeat center center;
      background-size: cover;
      overflow: hidden;
    }
    #game-container {
      position: relative;
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }
    #trap {
      position: absolute;
      bottom: 100px;
      left: 50%;
      width: 80px;
      height: 60px;
      background: url('https://i.imgur.com/XyZnpBl.png') no-repeat center;
      background-size: contain;
      transform: translateX(-50%);
      cursor: grab;
    }
    #catch {
      position: absolute;
      bottom: 180px;
      width: 60px;
      height: 60px;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      color: white;
      background: rgba(0,0,0,0.5);
      padding: 12px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
    }
    #leaderboard {
      margin-top: 10px;
      background: rgba(255,255,255,0.1);
      padding: 5px;
      border-radius: 8px;
    }
    #cast-btn, #restart-btn, #mute-btn {
      margin-top: 10px;
      padding: 8px 20px;
      border: none;
      border-radius: 8px;
      background: #1e90ff;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    #restart-btn {
      background: #ff6347;
    }
    @media (max-width: 600px) {
      #trap { width: 60px; height: 45px; }
      #catch { width: 50px; height: 50px; }
      #cast-btn, #restart-btn, #mute-btn { font-size: 14px; padding: 6px 16px; }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="trap" tabindex="0"></div>
    <div id="catch"></div>
    <div id="ui">
      <h2>üé£ On 'Em ‚Äì Weymouth Wharf</h2>
      <p id="info">Cast the trap to catch lobsters!</p>
      <p>Score: <span id="score">0</span> | Time Left: <span id="timer">60</span>s</p>
      <button id="cast-btn">üéØ Cast Trap</button>
      <button id="restart-btn" style="display:none;">üîÅ Restart</button>
      <button id="mute-btn">üîá Mute</button>
      <div id="leaderboard">
        <h4>üèÜ Leaderboard</h4>
        <ol id="scores"></ol>
      </div>
    </div>
  </div>

  <audio id="cast-sound" src="https://www.soundjay.com/button/beep-07.mp3"></audio>
  <audio id="catch-sound" src="https://www.soundjay.com/button/button-3.mp3"></audio>
  <audio id="bg-sound" src="https://www.fesliyanstudios.com/play-mp3/387" loop></audio>

  <script>
    const trap = document.getElementById('trap');
    const catchDiv = document.getElementById('catch');
    const info = document.getElementById('info');
    const scoreSpan = document.getElementById('score');
    const timerSpan = document.getElementById('timer');
    const castBtn = document.getElementById('cast-btn');
    const restartBtn = document.getElementById('restart-btn');
    const scoresList = document.getElementById('scores');
    const muteBtn = document.getElementById('mute-btn');

    const castSound = document.getElementById('cast-sound');
    const catchSound = document.getElementById('catch-sound');
    const bgSound = document.getElementById('bg-sound');

    let score = 0;
    let timeLeft = 60;
    let gameActive = true;
    let muted = false;

    const creatures = [
      { name: 'Lobster', points: 10, img: 'https://i.imgur.com/3l8HzF2.png' },
      { name: 'Crab', points: 5, img: 'https://i.imgur.com/L7rj1M3.png' },
      { name: 'Boot', points: 0, img: 'https://i.imgur.com/1Gc8xDb.png' },
    ];

    function updateLeaderboard() {
      const board = JSON.parse(localStorage.getItem('onem-leaderboard') || '[]');
      scoresList.innerHTML = '';
      board.slice(0, 5).forEach(({ name, score }) => {
        const li = document.createElement('li');
        li.textContent = `${name}: ${score}`;
        scoresList.appendChild(li);
      });
    }

    function saveScore() {
      const name = prompt("Enter your name for the leaderboard:") || "Anonymous";
      const board = JSON.parse(localStorage.getItem('onem-leaderboard') || '[]');
      board.push({ name, score });
      board.sort((a, b) => b.score - a.score);
      localStorage.setItem('onem-leaderboard', JSON.stringify(board.slice(0, 5)));
      updateLeaderboard();
    }

    function getCatch() {
      const r = Math.random();
      if (r < 0.5) return creatures[0];
      if (r < 0.8) return creatures[1];
      return creatures[2];
    }

    function castTrap() {
      if (!gameActive) return;
      info.textContent = "Casting trap...";
      castSound.play();
      catchDiv.innerHTML = '';
      setTimeout(() => {
        const caught = getCatch();
        score += caught.points;
        scoreSpan.textContent = score;
        info.textContent = caught.points > 0
          ? `Caught a ${caught.name}! +${caught.points}`
          : `You caught a ${caught.name}... no points.`;
        catchDiv.innerHTML = `<img src="${caught.img}" width="60"/>`;
        catchSound.play();
      }, 800);
    }

    function startGame() {
      score = 0;
      timeLeft = 60;
      gameActive = true;
      scoreSpan.textContent = score;
      timerSpan.textContent = timeLeft;
      info.textContent = "Cast the trap to catch lobsters!";
      restartBtn.style.display = 'none';
      bgSound.play();
      const timer = setInterval(() => {
        if (!gameActive) return clearInterval(timer);
        timeLeft--;
        timerSpan.textContent = timeLeft;
        if (timeLeft <= 0) {
          gameActive = false;
          info.textContent = `Game Over! Final Score: ${score}`;
          castBtn.disabled = true;
          restartBtn.style.display = 'inline-block';
          bgSound.pause();
          saveScore();
        }
      }, 1000);
    }

    // Event bindings
    castBtn.onclick = castTrap;
    restartBtn.onclick = () => {
      castBtn.disabled = false;
      startGame();
    };
    muteBtn.onclick = () => {
      muted = !muted;
      [castSound, catchSound, bgSound].forEach(s => s.muted = muted);
      muteBtn.textContent = muted ? "üîä Unmute" : "üîá Mute";
    };

    // Drag logic
    let dragging = false, offsetX = 0;
    trap.addEventListener('mousedown', e => {
      dragging = true;
      offsetX = e.offsetX;
    });
    window.addEventListener('mouseup', () => dragging = false);
    window.addEventListener('mousemove', e => {
      if (!dragging || !gameActive) return;
      let x = e.clientX - offsetX;
      const containerWidth = document.getElementById('game-container').offsetWidth;
      const trapWidth = trap.offsetWidth;
      x = Math.max(0, Math.min(containerWidth - trapWidth, x));
      trap.style.left = x + 'px';
      catchDiv.style.left = (x + 10) + 'px';
    });

    // Arrow key controls
    trap.addEventListener('keydown', e => {
      const move = 15;
      let left = trap.offsetLeft;
      if (e.key === "ArrowLeft") left -= move;
      if (e.key === "ArrowRight") left += move;
      left = Math.max(0, Math.min(window.innerWidth - trap.offsetWidth, left));
      trap.style.left = left + 'px';
      catchDiv.style.left = (left + 10) + 'px';
      if (e.key === "Enter" || e.key === " ") castTrap();
    });

    updateLeaderboard();
    startGame();
  </script>
</body>
</html>