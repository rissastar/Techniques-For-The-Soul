<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Recovery Toolkit</title>
<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  html, body {
    margin: 0; padding: 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(145deg, #ff6ec4, #7873f5);
    color: #fff;
    height: 100%;
    -webkit-tap-highlight-color: transparent;
    overflow-x: hidden;
  }
  header {
    padding: 1.5rem 1rem;
    background: #fff;
    color: #111;
    text-align: center;
    border-bottom: 4px solid #ff6ec4;
  }
  header h1 {
    font-size: 1.8rem;
    margin: 0;
    font-weight: bold;
  }
  header p {
    margin-top: 0.3rem;
    font-size: 1rem;
    font-style: italic;
  }
  nav {
    display: flex;
    overflow-x: auto;
    background: #111;
  }
  nav button {
    flex: 1;
    padding: 0.8rem;
    background: transparent;
    color: #fff;
    border: none;
    font-size: 0.95rem;
    white-space: nowrap;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: 0.3s ease;
  }
  nav button.active {
    border-bottom: 3px solid #ff6ec4;
    background: #222;
  }
  .tab-content {
    padding: 1rem;
    display: none;
  }
  .tab-content.active {
    display: block;
  }
  .tool-card {
    background: #fff;
    color: #222;
    border-radius: 10px;
    margin-bottom: 1rem;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  .tool-header {
    padding: 1rem;
    font-weight: bold;
    font-size: 1rem;
    background: #ff6ec4;
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
  }
  .tool-body {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.35s ease;
    background: #f9f9f9;
    color: #333;
    padding: 0 1rem;
  }
  .tool-body.open {
    max-height: 700px;
    padding: 1rem;
  }
  .tool-body p {
    margin: 0 0 1rem;
    line-height: 1.5;
  }
  .notes label {
    font-weight: bold;
    display: block;
    margin: 0.5rem 0 0.2rem;
  }
  .notes textarea {
    width: 100%;
    padding: 0.6rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    resize: vertical;
    font-size: 1rem;
    font-family: inherit;
  }
  #sober-counter {
    background: #ff6ec4;
    color: #fff;
    padding: 1rem;
    font-weight: bold;
    font-size: 1.2rem;
    text-align: center;
    border-radius: 10px;
    margin: 1rem 1rem 0 1rem;
  }
  #sober-counter input[type="date"] {
    margin-top: 0.5rem;
    padding: 0.4rem;
    border-radius: 6px;
    border: none;
    font-size: 1rem;
  }
  #sober-counter button {
    margin-left: 0.6rem;
    background: #fff;
    color: #ff6ec4;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s ease;
  }
  #sober-counter button:hover {
    background: #ffe1f4;
  }
  #achievements {
    background: #fff;
    color: #222;
    padding: 1rem;
    border-radius: 10px;
    margin: 0 1rem 1rem 1rem;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
  }
  #achievements h2 {
    margin-top: 0;
    color: #ff6ec4;
    font-weight: bold;
  }
  .achievement {
    display: flex;
    align-items: center;
    margin-bottom: 0.7rem;
    font-weight: 600;
    font-size: 1rem;
  }
  .achievement.locked {
    color: #bbb;
  }
  .achievement span.icon {
    font-size: 1.4rem;
    margin-right: 0.6rem;
  }
  #daily-quote {
    background: #fff;
    color: #222;
    margin: 1rem 1rem 1rem 1rem;
    padding: 1rem;
    border-radius: 10px;
    font-style: italic;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    user-select: none;
  }
  #daily-quote button {
    margin-top: 0.6rem;
    background: #ff6ec4;
    color: #fff;
    border: none;
    padding: 0.4rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  #daily-quote button:hover {
    background: #d647b0;
  }
  iframe {
    width: 100%;
    height: 400px;
    border: none;
    border-radius: 10px;
    margin-top: 0.5rem;
  }
  @media (min-width: 700px) {
    body {
      max-width: 480px;
      margin: 0 auto;
    }
  }
</style>
</head>
<body>
<header>
  <h1>üõ† Recovery Toolkit</h1>
  <p>Your portable pocket guide for healing</p>
</header>

<div id="sober-counter">
  Sober Days: <span id="sober-days">0</span><br/>
  <label for="start-date">Select your sober start date:</label><br/>
  <input type="date" id="start-date" /><button id="reset-sober">Reset</button>
</div>

<div id="achievements">
  <h2>üèÖ Achievements</h2>
  <div id="achievement-list">
    <!-- Achievements will appear here -->
  </div>
</div>

<nav>
  <button class="active" data-tab="crisis">üö® Crisis</button>
  <button data-tab="mental">üß† Mental</button>
  <button data-tab="trauma">‚ù§Ô∏è Trauma</button>
  <button data-tab="boundaries">üí¨ Boundaries</button>
  <button data-tab="identity">‚ú® Identity</button>
  <button data-tab="wellness">üåø Wellness</button>
  <button data-tab="growth">üèÜ Growth</button>
  <button data-tab="minipages">üìÇ Mini Pages</button>
</nav>

<div id="tabs">

  <!-- Crisis Tab -->
  <div class="tab-content active" id="crisis">
    <div class="tool-card">
      <div class="tool-header">üåä Urge Surfing Practice</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Observe urges rise and fall like waves. Don‚Äôt act ‚Äî just witness.</p>
        <p><strong>Example:</strong> When craving hits, sit quietly and watch the sensation pass like a wave.</p>
        <p><strong>Prompt:</strong> What did you notice about your urge today? How long did it last?</p>
        <div class="notes">
          <label for="note-crisis-1">Your Notes</label>
          <textarea id="note-crisis-1"></textarea>
        </div>
      </div>
    </div>
    <div class="tool-card">
      <div class="tool-header">‚è≥ 15-Minute Delay</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Delay acting on the urge. Distract, breathe, or walk. Re-evaluate after 15 mins.</p>
        <p><strong>Example:</strong> Use a timer on your phone and focus on deep breathing until it ends.</p>
        <p><strong>Prompt:</strong> Did the urge change after the delay? What helped distract you?</p>
        <div class="notes">
          <label for="note-crisis-2">Your Notes</label>
          <textarea id="note-crisis-2"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Mental Tab -->
  <div class="tab-content" id="mental">
    <div class="tool-card">
      <div class="tool-header">üé≠ Name the Feeling</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Say what you feel: ‚ÄúI feel anxious.‚Äù Naming emotions gives power over them.</p>
        <p><strong>Example:</strong> Pause and say, ‚ÄúRight now, I‚Äôm feeling stressed.‚Äù</p>
        <p><strong>Prompt:</strong> What emotions came up for you today?</p>
        <div class="notes">
          <label for="note-mental-1">Your Notes</label>
          <textarea id="note-mental-1"></textarea>
        </div>
      </div>
    </div>
    <div class="tool-card">
      <div class="tool-header">üîÑ Thought Reframing</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Challenge and reframe negative thoughts into helpful ones.</p>
        <p><strong>Example:</strong> Change ‚ÄúI always fail‚Äù to ‚ÄúI‚Äôm learning and improving every day.‚Äù</p>
        <p><strong>Prompt:</strong> Which negative thought can you reframe today?</p>
        <div class="notes">
          <label for="note-mental-2">Your Notes</label>
          <textarea id="note-mental-2"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Trauma Tab -->
  <div class="tab-content" id="trauma">
    <div class="tool-card">
      <div class="tool-header">üßò‚Äç‚ôÇÔ∏è Grounding & Body Scan</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Use your 5 senses or scan your body to feel present. Anchors you in the now.</p>
        <p><strong>Example:</strong> Notice 5 things you see, 4 things you touch, 3 things you hear, etc.</p>
        <p><strong>Prompt:</strong> How did grounding affect your feelings?</p>
        <div class="notes">
          <label for="note-trauma-1">Your Notes</label>
          <textarea id="note-trauma-1"></textarea>
        </div>
      </div>
    </div>
    <div class="tool-card">
      <div class="tool-header">‚è™ Flashback Management</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Use grounding objects, cold water, or calming breath when overwhelmed by past memories.</p>
        <p><strong>Example:</strong> Hold a comforting object or splash cold water on your face.</p>
        <p><strong>Prompt:</strong> What grounding technique worked best for you?</p>
        <div class="notes">
          <label for="note-trauma-2">Your Notes</label>
          <textarea id="note-trauma-2"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Boundaries Tab -->
  <div class="tab-content" id="boundaries">
    <div class="tool-card">
      <div class="tool-header">üó£Ô∏è Assertive Scripts</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Practice clear, kind boundaries like ‚ÄúI‚Äôm not available right now.‚Äù</p>
        <p><strong>Example:</strong> Say, ‚ÄúI need some time alone.‚Äù or ‚ÄúThat doesn‚Äôt work for me.‚Äù</p>
        <p><strong>Prompt:</strong> What boundary can you practice today?</p>
        <div class="notes">
          <label for="note-boundaries-1">Your Notes</label>
          <textarea id="note-boundaries-1"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Identity Tab -->
  <div class="tab-content" id="identity">
    <div class="tool-card">
      <div class="tool-header">üîç Who Am I Without Trauma?</div>
      <div class="tool-body">
        <p><strong>Description:</strong> List what brings you joy and your values. Explore your true self.</p>
        <p><strong>Example:</strong> Write a list of hobbies or things that make you smile.</p>
        <p><strong>Prompt:</strong> What is one thing you love about yourself?</p>
        <div class="notes">
          <label for="note-identity-1">Your Notes</label>
          <textarea id="note-identity-1"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Wellness Tab -->
  <div class="tab-content" id="wellness">
    <div class="tool-card">
      <div class="tool-header">üõèÔ∏è Sleep Hygiene</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Wind-down routine, phone off, lights low. Try calming breath before bed.</p>
        <p><strong>Example:</strong> Turn off screens 30 mins before bedtime and practice deep breathing.</p>
        <p><strong>Prompt:</strong> How can you improve your sleep tonight?</p>
        <div class="notes">
          <label for="note-wellness-1">Your Notes</label>
          <textarea id="note-wellness-1"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Growth Tab -->
  <div class="tab-content" id="growth">
    <div class="tool-card">
      <div class="tool-header">‚úÖ What Worked Today?</div>
      <div class="tool-body">
        <p><strong>Description:</strong> Reflect on one thing you did well. Acknowledge progress, no matter how small.</p>
        <p><strong>Example:</strong> ‚ÄúI asked for help when I needed it.‚Äù</p>
        <p><strong>Prompt:</strong> What is one win you want to remember?</p>
        <div class="notes">
          <label for="note-growth-1">Your Notes</label>
          <textarea id="note-growth-1"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Mini Pages Tab -->
  <div class="tab-content" id="minipages">
    <p style="padding:0 1rem; font-style: italic; color: #ddd; font-size: 0.9rem; margin-bottom: 1rem;">
      Explore original tools and stories that inspired this app. These embedded pages come straight from the heart.
    </p>
    <div class="tool-card">
      <div class="tool-header">üìõ Crisis Toolkit</div>
      <div class="tool-body">
        <iframe src="https://rissastar.github.io/Techniques-For-The-Soul/crisis-toolkit.html" loading="lazy"></iframe>
      </div>
    </div>
    <div class="tool-card">
      <div class="tool-header">üé° Recovery Affirmation Wheel</div>
      <div class="tool-body">
        <iframe src="https://rissastar.github.io/Techniques-For-The-Soul/recoveryaffirmation.html" loading="lazy"></iframe>
      </div>
    </div>
    <div class="tool-card">
      <div class="tool-header">üåç Grounding Tools</div>
      <div class="tool-body">
        <iframe src="https://rissastar.github.io/Techniques-For-The-Soul/grounding-toolkit.html" loading="lazy"></iframe>
      </div>
    </div>
    <div class="tool-card">
      <div class="tool-header">üìñ Tell Your Story or Read Others</div>
      <div class="tool-body">
        <iframe src="https://rissastar.github.io/Techniques-For-The-Soul/stories.html" loading="lazy"></iframe>
      </div>
    </div>
  </div>
</div>

<div id="daily-quote" aria-live="polite" aria-atomic="true">
  <div id="quote-text">Loading daily inspiration‚Ä¶</div>
  <button id="refresh-quote" aria-label="Show another quote">New Quote</button>
</div>

<script>
  // Tab switching
  const tabButtons = document.querySelectorAll("nav button");
  const tabContents = document.querySelectorAll(".tab-content");

  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const tab = btn.getAttribute("data-tab");
      tabButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      tabContents.forEach(content => {
        content.classList.remove("active");
        if(content.id === tab) content.classList.add("active");
      });
      // Scroll top on tab change
      window.scrollTo(0, 0);
    });
  });

  // Expand/collapse tool bodies
  document.querySelectorAll(".tool-header").forEach(header => {
    header.addEventListener("click", () => {
      const body = header.nextElementSibling;
      body.classList.toggle("open");
    });
  });

  // LocalStorage save/load for all textareas
  document.querySelectorAll("textarea").forEach(textarea => {
    const id = textarea.id;
    const saved = localStorage.getItem(id);
    if(saved) textarea.value = saved;
    textarea.addEventListener("input", () => {
      localStorage.setItem(id, textarea.value);
      checkAchievements();
    });
  });

  // Sober Day Counter Logic
  const soberDaysEl = document.getElementById("sober-days");
  const startDateInput = document.getElementById("start-date");
  const resetButton = document.getElementById("reset-sober");

  function calculateSoberDays(start) {
    const today = new Date();
    const startDate = new Date(start);
    const diff = today - startDate;
    return diff > 0 ? Math.floor(diff / (1000*60*60*24)) + 1 : 0;
  }

  function updateSoberDays() {
    const stored = localStorage.getItem("soberStartDate");
    if(stored) {
      startDateInput.value = stored;
      const days = calculateSoberDays(stored);
      soberDaysEl.textContent = days;
    } else {
      soberDaysEl.textContent = "0";
    }
  }

  startDateInput.addEventListener("change", () => {
    if(startDateInput.value) {
      localStorage.setItem("soberStartDate", startDateInput.value);
      updateSoberDays();
      checkAchievements();
    }
  });

  resetButton.addEventListener("click", () => {
    localStorage.removeItem("soberStartDate");
    startDateInput.value = "";
    soberDaysEl.textContent = "0";
    checkAchievements();
  });

  updateSoberDays();

  // Achievements System
  const achievementListEl = document.getElementById("achievement-list");

  const achievements = [
    {
      id: "7days",
      title: "1 Week Sober",
      description: "You‚Äôve reached 7 days sober! Keep going!",
      icon: "üéâ",
      condition: () => {
        const d = localStorage.getItem("soberStartDate");
        if(!d) return false;
        return calculateSoberDays(d) >= 7;
      }
    },
    {
      id: "30days",
      title: "1 Month Sober",
      description: "30 days sober! Amazing commitment!",
      icon: "üèÜ",
      condition: () => {
        const d = localStorage.getItem("soberStartDate");
        if(!d) return false;
        return calculateSoberDays(d) >= 30;
      }
    },
    {
      id: "toolNotes",
      title: "Tools in Use",
      description: "You‚Äôve added notes in all tool categories. Way to engage!",
      icon: "üìù",
      condition: () => {
        // Check if all note textareas have some content
        const noteIds = [
          "note-crisis-1", "note-crisis-2",
          "note-mental-1", "note-mental-2",
          "note-trauma-1", "note-trauma-2",
          "note-boundaries-1",
          "note-identity-1",
          "note-wellness-1",
          "note-growth-1"
        ];
        return noteIds.every(id => {
          const val = localStorage.getItem(id);
          return val && val.trim().length > 0;
        });
      }
    },
    {
      id: "returnUser",
      title: "Welcome Back",
      description: "You‚Äôve opened the toolkit multiple times. Keep returning!",
      icon: "üëã",
      condition: () => {
        const count = parseInt(localStorage.getItem("returnCount") || "0", 10);
        return count >= 5;
      }
    }
  ];

  function renderAchievements() {
    achievementListEl.innerHTML = "";
    achievements.forEach(a => {
      const unlocked = a.condition();
      const div = document.createElement("div");
      div.className = "achievement" + (unlocked ? "" : " locked");
      div.innerHTML = `<span class="icon">${unlocked ? a.icon : "üîí"}</span><div><strong>${a.title}</strong><br/><small>${a.description}</small></div>`;
      achievementListEl.appendChild(div);
    });
  }

  function checkAchievements() {
    renderAchievements();
  }

  // Track number of visits
  function trackReturnCount() {
    let count = parseInt(localStorage.getItem("returnCount") || "0", 10);
    count++;
    localStorage.setItem("returnCount", count.toString());
  }
  trackReturnCount();

  checkAchievements();

  // Daily Motivational Quotes
  const quotes = [
    "Recovery is a journey, not a race.",
    "One day at a time is enough.",
    "You are stronger than your struggles.",
    "Small progress is still progress.",
    "Healing begins with self-compassion.",
    "Your story is still being written.",
    "Courage doesn‚Äôt always roar.",
    "Keep going; your future self thanks you.",
    "Every step forward counts.",
    "You are not alone on this path."
  ];

  const quoteTextEl = document.getElementById("quote-text");
  const refreshQuoteBtn = document.getElementById("refresh-quote");

  function showQuote(index) {
    quoteTextEl.textContent = quotes[index];
  }

  function getTodayIndex() {
    const today = new Date();
    // Cycle through quotes by date mod length
    return today.getDate() % quotes.length;
  }

  function initQuote() {
    const savedIndex = localStorage.getItem("dailyQuoteIndex");
    const todayIndex = getTodayIndex();

    if(savedIndex == null || parseInt(savedIndex) !== todayIndex) {
      localStorage.setItem("dailyQuoteIndex", todayIndex);
      showQuote(todayIndex);
    } else {
      showQuote(parseInt(savedIndex));
    }
  }

  refreshQuoteBtn.addEventListener("click", () => {
    // Show random quote different from current
    let currentIndex = parseInt(localStorage.getItem("dailyQuoteIndex") || "0", 10);
    let newIndex;
    do {
      newIndex = Math.floor(Math.random() * quotes.length);
    } while(newIndex === currentIndex);
    localStorage.setItem("dailyQuoteIndex", newIndex);
    showQuote(newIndex);
  });

  initQuote();
</script>

<script>
  // Open/close embedded iframe tool bodies on header click
  document.querySelectorAll("#minipages .tool-header").forEach(header => {
    header.addEventListener("click", () => {
      const body = header.nextElementSibling;
      body.classList.toggle("open");
    });
  });
</script>

<script>
  // Also enable expand/collapse for mini pages on load
  window.addEventListener("load", () => {
    document.querySelectorAll(".tool-header").forEach(header => {
      header.addEventListener("click", () => {
        const body = header.nextElementSibling;
        body.classList.toggle("open");
      });
    });
  });
</script>

</body>
</html>