<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Addiction & Recovery Toolkit</title>
<style>
  /* Basic Reset and styling */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    margin: 0; padding: 0;
    color: #333;
  }
  h2, h3, h4 {
    margin-top: 0;
  }
  .container {
    max-width: 900px;
    margin: 30px auto;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    padding: 20px;
  }
  .nav-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }
  .nav-tab {
    cursor: pointer;
    padding: 12px 20px;
    margin: 0 5px;
    background: #3498db;
    color: white;
    border-radius: 8px 8px 0 0;
    user-select: none;
    transition: background 0.3s;
  }
  .nav-tab.active,
  .nav-tab:focus {
    background: #2980b9;
    outline: 2px solid #1c5980;
    outline-offset: 2px;
  }
  .tab-content {
    display: none;
    opacity: 0;
    transition: opacity 0.4s ease;
  }
  .tab-content.active {
    display: block;
    opacity: 1;
  }
  .card {
    background: #fafafa;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    padding: 20px;
    margin-bottom: 20px;
  }
  .form-group {
    margin-bottom: 15px;
  }
  label.form-label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
  }
  input.form-input,
  textarea.form-input,
  input[type="range"] {
    width: 100%;
    padding: 10px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 1rem;
    box-sizing: border-box;
  }
  input[type="range"] {
    height: 30px;
  }
  textarea.form-input {
    resize: vertical;
  }
  button.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.3s ease;
    user-select: none;
  }
  button.btn:hover,
  button.btn:focus {
    transform: scale(1.05);
    outline: none;
  }
  button.btn-success {
    background: #2ecc71;
    color: white;
  }
  button.btn-success:focus {
    outline: 3px solid #27ae60;
  }
  button.btn-primary {
    background: #3498db;
    color: white;
  }
  button.btn-primary:focus {
    outline: 3px solid #2980b9;
  }
  button.btn-danger {
    background: #e74c3c;
    color: white;
  }
  button.btn-danger:focus {
    outline: 3px solid #c0392b;
  }
  button.btn-warning {
    background: #f39c12;
    color: white;
  }
  button.btn-warning:focus {
    outline: 3px solid #d68910;
  }

  .resource-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 15px;
  }
  .resource-card {
    background: white;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.07);
    text-align: center;
  }

  .achievements {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
  }
  .achievement {
    flex: 1 1 130px;
    background: #e9ecef;
    padding: 15px;
    border-radius: 12px;
    color: #555;
    user-select: none;
  }
  .achievement.locked {
    filter: grayscale(80%);
    opacity: 0.6;
  }
  .achievement.unlocked {
    background: #2ecc71;
    color: white;
    box-shadow: 0 4px 15px rgba(46,204,113,0.6);
  }

  /* Sobriety counter style */
  #sobrietyCounter {
    font-size: 3rem;
    font-weight: 700;
    color: #27ae60;
  }
  #dailyQuote {
    font-style: italic;
    font-size: 1.2rem;
    margin-top: 10px;
    color: #555;
    min-height: 3em;
  }

  /* Mood buttons */
  .mood-btn {
    cursor: pointer;
    border: 2px solid #3498db;
    background: white;
    color: #3498db;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 1.5rem;
    line-height: 44px;
    text-align: center;
    user-select: none;
    margin-right: 10px;
    transition: all 0.3s ease;
  }
  .mood-btn.selected {
    background: #3498db;
    color: white;
  }
  .mood-btn:focus {
    outline: 3px solid #2980b9;
    outline-offset: 2px;
  }

  /* Accessibility: Skip link */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 10px;
    background: #3498db;
    color: white;
    padding: 8px 12px;
    z-index: 10000;
    border-radius: 5px;
    transition: top 0.3s ease;
  }
  .skip-link:focus {
    top: 10px;
  }

  /* Emergency banner */
  .emergency-banner {
    background: #e74c3c;
    color: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    font-weight: 700;
    margin-bottom: 20px;
  }

  /* Animations */
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }
  @keyframes fadeInModal {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes fadeOutModal {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  /* Modal base style */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    animation: fadeInModal 0.3s forwards;
  }
  .modal-content {
    background: white;
    padding: 40px 30px;
    border-radius: 20px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-sizing: border-box;
    outline: none;
  }
  .modal-content:focus {
    outline: 3px solid #3498db;
  }
</style>
</head>
<body>

<a href="#mainContent" class="skip-link">Skip to main content</a>

<div class="container" id="mainContent" tabindex="-1">

  <h2>Addiction & Recovery Toolkit</h2>

  <!-- Emergency banner for US & Canada -->
  <div class="emergency-banner" role="alert" aria-live="assertive">
    üö® Need Immediate Help? <br />
    <strong>US:</strong> Crisis Text Line: Text <code>HOME</code> to 741741 | Suicide Lifeline: <code>988</code><br />
    <strong>Canada:</strong> Crisis Services Canada: 1-833-456-4566 | Text <code>45645</code>
  </div>

  <!-- Navigation Tabs -->
  <nav class="nav-tabs" role="tablist" aria-label="Main sections">
    <button class="nav-tab active" role="tab" aria-selected="true" aria-controls="tracker" id="tab-tracker" tabindex="0" onclick="showTab('tracker', this)">Tracker</button>
    <button class="nav-tab" role="tab" aria-selected="false" aria-controls="crisis" id="tab-crisis" tabindex="-1" onclick="showTab('crisis', this)">Crisis Planning</button>
    <button class="nav-tab" role="tab" aria-selected="false" aria-controls="wellness" id="tab-wellness" tabindex="-1" onclick="showTab('wellness', this)">Wellness</button>
    <button class="nav-tab" role="tab" aria-selected="false" aria-controls="achievements" id="tab-achievements" tabindex="-1" onclick="showTab('achievements', this)">Achievements</button>
  </nav>

  <div>
    <!-- Tracker Tab -->
    <section id="tracker" class="tab-content active" role="tabpanel" aria-labelledby="tab-tracker" tabindex="0">
      <div class="card">
        <h3>Recovery Tracker</h3>
        <p>Days sober: <span id="sobrietyCounter" aria-live="polite" aria-atomic="true">0</span></p>
        <button class="btn btn-primary" onclick="updateSobrietyDate()" aria-label="Set recovery start date">Set Recovery Start Date</button>
        <button class="btn btn-danger" onclick="resetCounter()" aria-label="Reset recovery counter to today">Reset Counter</button>
        <p id="dailyQuote" aria-live="polite" aria-atomic="true" style="margin-top:1em;"></p>
      </div>

      <div class="card" aria-label="Mood and reflection">
        <h3>Daily Mood & Reflection</h3>
        <div role="radiogroup" aria-labelledby="moodLabel" style="margin-bottom: 15px;">
          <span id="moodLabel" style="font-weight: 600;">Select your mood:</span>
          <button class="mood-btn" data-mood="happy" aria-pressed="false" aria-label="Happy mood" onclick="setMood('happy')">üòä</button>
          <button class="mood-btn" data-mood="neutral" aria-pressed="false" aria-label="Neutral mood" onclick="setMood('neutral')">üòê</button>
          <button class="mood-btn" data-mood="sad" aria-pressed="false" aria-label="Sad mood" onclick="setMood('sad')">üòî</button>
          <button class="mood-btn" data-mood="anxious" aria-pressed="false" aria-label="Anxious mood" onclick="setMood('anxious')">üò∞</button>
        </div>
        <label for="reflectionInput" class="form-label">Write your reflection:</label>
        <textarea id="reflectionInput" class="form-input" rows="4" aria-describedby="reflectionDesc" placeholder="How are you feeling today?"></textarea>
        <small id="reflectionDesc" style="display:block; margin-bottom:10px;">Your daily thoughts and feelings help track your progress.</small>
        <button class="btn btn-success" onclick="saveProgress()" aria-label="Save daily mood and reflection">Save Progress</button>
      </div>

      <div class="card" aria-label="Export data">
        <h3>Export Your Data</h3>
        <button class="btn btn-primary" onclick="exportData()" aria-label="Download your recovery data as a JSON file">Download Recovery Data</button>
      </div>
    </section>

    <!-- Crisis Planning Tab -->
    <section id="crisis" class="tab-content" role="tabpanel" aria-labelledby="tab-crisis" tabindex="0">
      <div class="card">
        <h3>Crisis Planning</h3>
        <div class="form-group">
          <label for="emergencyContactName" class="form-label">Emergency Contact Name</label>
          <input type="text" id="emergencyContactName" class="form-input" placeholder="Name of trusted person" aria-required="true" />
        </div>
        <div class="form-group">
          <label for="emergencyContactPhone" class="form-label">Emergency Contact Phone</label>
          <input type="tel" id="emergencyContactPhone" class="form-input" placeholder="Phone number" aria-required="true" />
        </div>
        <div class="form-group">
          <label for="personalTriggers" class="form-label">Personal Triggers to Avoid</label>
          <textarea id="personalTriggers" class="form-input" rows="3" placeholder="List situations, places, or emotions that might trigger you..."></textarea>
        </div>
        <button class="btn btn-success" aria-label="Save crisis plan">Save Crisis Plan</button>
      </div>
    </section>

    <!-- Wellness Tab -->
    <section id="wellness" class="tab-content" role="tabpanel" aria-labelledby="tab-wellness" tabindex="0">
      <div class="card">
        <h3>Daily Wellness Check</h3>
        <div class="form-group">
          <label for="sleepQuality" class="form-label">Sleep Quality (1-10)</label>
          <input id="sleepQuality" type="range" min="1" max="10" value="7" class="form-input" />
        </div>
        <div class="form-group">
          <label for="energyLevel" class="form-label">Energy Level (1-10)</label>
          <input id="energyLevel" type="range" min="1" max="10" value="7" class="form-input" />
        </div>
        <div class="form-group">
          <label for="stressLevel" class="form-label">Stress Level (1-10)</label>
          <input id="stressLevel" type="range" min="1" max="10" value="5" class="form-input" />
        </div>
        <button class="btn btn-success" aria-label="Log wellness data">Log Wellness Data</button>
      </div>

      <div class="card">
        <h3>Coping Strategies</h3>
        <div class="resource-grid">
          <div class="resource-card">
            <h4>üßò‚Äç‚ôÄÔ∏è Mindfulness</h4>
            <p>Practice deep breathing, meditation, or grounding exercises</p>
            <button class="btn btn-primary" onclick="startBreathingExercise()" aria-label="Start 5-minute meditation">Start 5-min Meditation</button>
          </div>
          <div class="resource-card">
            <h4>üèÉ‚Äç‚ôÇÔ∏è Physical Activity</h4>
            <p>Go for a walk, do yoga, or any form of exercise</p>
            <button class="btn btn-primary" onclick="alert('Check out online workout videos!')" aria-label="Find workout videos">Find Workout Videos</button>
          </div>
          <div class="resource-card">
            <h4>üé® Creative Expression</h4>
            <p>Draw, write, play music, or engage in any creative activity</p>
            <button class="btn btn-primary" onclick="alert('Try art therapy ideas!')" aria-label="Get art therapy ideas">Art Therapy Ideas</button>
          </div>
          <div class="resource-card">
            <h4>üìû Reach Out</h4>
            <p>Call a friend, sponsor, or support group member</p>
            <button class="btn btn-primary" onclick="alert('Open your contact list')" aria-label="Open contact list">Contact List</button>
          </div>
        </div>
      </div>

      <!-- Crisis Management Tools appended dynamically by JS -->
    </section>

    <!-- Achievements Tab -->
    <section id="achievements" class="tab-content" role="tabpanel" aria-labelledby="tab-achievements" tabindex="0">
      <div class="card">
        <h3>Recovery Milestones</h3>
        <div class="achievements" aria-live="polite" aria-atomic="true" aria-label="Recovery milestones">
          <div class="achievement locked" id="day1" tabindex="0">
            <h4>üåÖ First Day</h4>
            <p>Complete your first day of recovery</p>
          </div>
          <div class="achievement locked" id="week1" tabindex="0">
            <h4>üìÖ One Week</h4>
            <p>Seven days strong</p>
          </div>
          <div class="achievement locked" id="month1" tabindex="0">
            <h4>üóìÔ∏è One Month</h4>
            <p>30 days of recovery</p>
          </div>
          <div class="achievement locked" id="month3" tabindex="0">
            <h4>üå∏ Three Months</h4>
            <p>90 days milestone</p>
          </div>
          <div class="achievement locked" id="month6" tabindex="0">
            <h4>üåª Six Months</h4>
            <p>Half a year sober</p>
          </div>
          <div class="achievement locked" id="year1" tabindex="0">
            <h4>üéâ One Year</h4>
            <p>365 days sober</p>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- Modal Container -->
<div id="modalContainer" aria-live="polite"></div>

<script>
  // --- Tab Navigation with ARIA ---
  function showTab(tabId, tabBtn) {
    // Hide all tab contents and update tab buttons
    const tabs = document.querySelectorAll('.tab-content');
    const tabButtons = document.querySelectorAll('.nav-tab');
    tabs.forEach(t => {
      t.classList.remove('active');
      t.setAttribute('tabindex', '-1');
    });
    tabButtons.forEach(btn => {
      btn.classList.remove('active');
      btn.setAttribute('aria-selected', 'false');
      btn.setAttribute('tabindex', '-1');
    });

    // Show selected tab content
    const selectedTab = document.getElementById(tabId);
    selectedTab.classList.add('active');
    selectedTab.setAttribute('tabindex', '0');
    selectedTab.focus();

    // Activate clicked tab button
    tabBtn.classList.add('active');
    tabBtn.setAttribute('aria-selected', 'true');
    tabBtn.setAttribute('tabindex', '0');
  }

  // --- Sobriety Counter ---
  let sobrietyStartDate = localStorage.getItem('sobrietyDate') ? new Date(localStorage.getItem('sobrietyDate')) : null;

  function updateSobrietyDate() {
    const input = prompt('Enter your recovery start date (YYYY-MM-DD):', sobrietyStartDate ? sobrietyStartDate.toISOString().slice(0,10) : '');
    if (input) {
      const d = new Date(input);
      if (!isNaN(d.getTime())) {
        sobrietyStartDate = d;
        localStorage.setItem('sobrietyDate', sobrietyStartDate.toISOString());
        updateCounterDisplay();
        checkAchievements();
      } else {
        alert('Invalid date format. Please use YYYY-MM-DD');
      }
    }
  }
  function resetCounter() {
    if (confirm('Are you sure you want to reset your recovery start date to today? This cannot be undone.')) {
      sobrietyStartDate = new Date();
      localStorage.setItem('sobrietyDate', sobrietyStartDate.toISOString());
      updateCounterDisplay();
      checkAchievements();
    }
  }
  function updateCounterDisplay() {
    const counterElem = document.getElementById('sobrietyCounter');
    if (!sobrietyStartDate) {
      counterElem.textContent = '0';
      return;
    }
    const now = new Date();
    const diff = now - sobrietyStartDate;
    const days = Math.floor(diff / (1000*60*60*24));
    counterElem.textContent = days >= 0 ? days : 0;
    // Daily quote
    const quotes = [
      "One day at a time.",
      "Progress, not perfection.",
      "Strength grows in the moments you think you can‚Äôt go on but you keep going anyway.",
      "Healing is a journey, not a destination.",
      "You are stronger than your struggles.",
      "Keep pushing forward."
    ];
    const quoteElem = document.getElementById('dailyQuote');
    quoteElem.textContent = quotes[days % quotes.length];
  }

  // --- Mood & Reflection ---
  let currentMood = null;

  function setMood(mood) {
    currentMood = mood;
    document.querySelectorAll('.mood-btn').forEach(btn => {
      btn.classList.toggle('selected', btn.dataset.mood === mood);
      btn.setAttribute('aria-pressed', btn.dataset.mood === mood ? 'true' : 'false');
    });
  }

  function saveProgress() {
    if (!currentMood) {
      alert('Please select a mood before saving.');
      return;
    }
    const reflection = document.getElementById('reflectionInput').value.trim();
    const today = new Date().toISOString().slice(0,10);

    // Load existing mood reflections from localStorage
    let moodReflections = JSON.parse(localStorage.getItem('moodReflections') || '{}');

    moodReflections[today] = {
      mood: currentMood,
      reflection: reflection
    };
    localStorage.setItem('moodReflections', JSON.stringify(moodReflections));
    alert('Progress saved for ' + today);
    checkAchievements();
  }

  // --- Export Data ---
  function exportData() {
    const moodReflections = JSON.parse(localStorage.getItem('moodReflections') || '{}');
    const sobrietyDateStr = sobrietyStartDate ? sobrietyStartDate.toISOString() : null;

    // Achievements unlocked
    const achievements = [];
    document.querySelectorAll('.achievement.unlocked').forEach(a => {
      achievements.push(a.querySelector('h4').textContent);
    });

    const data = {
      sobrietyDate: sobrietyDateStr,
      moodReflections: moodReflections,
      achievements: achievements
    };

    const dataStr = JSON.stringify(data, null, 2);
    const blob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = 'recovery_data.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // --- Achievements ---
  const achievementMilestones = {
    day1: 1,
    week1: 7,
    month1: 30,
    month3: 90,
    month6: 180,
    year1: 365
  };

  function checkAchievements() {
    if (!sobrietyStartDate) return;

    const now = new Date();
    const diffDays = Math.floor((now - sobrietyStartDate) / (1000*60*60*24));
    Object.entries(achievementMilestones).forEach(([id, daysNeeded]) => {
      const elem = document.getElementById(id);
      if (!elem) return;
      if (diffDays >= daysNeeded) {
        if (!elem.classList.contains('unlocked')) {
          elem.classList.remove('locked');
          elem.classList.add('unlocked');
          // Optionally announce for screen readers
          elem.setAttribute('aria-live', 'polite');
        }
      } else {
        elem.classList.add('locked');
        elem.classList.remove('unlocked');
      }
    });
  }

  // --- Simple breathing exercise modal ---
  function startBreathingExercise() {
    const modalContainer = document.getElementById('modalContainer');
    if (modalContainer.children.length > 0) return; // Prevent multiple modals

    const modal = document.createElement('div');
    modal.classList.add('modal-overlay');
    modal.tabIndex = -1;
    modal.setAttribute('role', 'dialog');
    modal.setAttribute('aria-modal', 'true');
    modal.setAttribute('aria-labelledby', 'breathTitle');
    modal.setAttribute('aria-describedby', 'breathDesc');

    modal.innerHTML = `
      <div class="modal-content" tabindex="0">
        <h3 id="breathTitle">5-Minute Breathing Exercise</h3>
        <p id="breathDesc">Follow the prompts: inhale deeply, hold, exhale slowly. Repeat.</p>
        <div id="breathTimer" aria-live="assertive" style="font-size:2rem; font-weight:bold; margin: 20px 0; text-align:center;">Ready?</div>
        <button class="btn btn-warning" id="closeModalBtn" aria-label="Close breathing exercise">Close</button>
      </div>
    `;
    modalContainer.appendChild(modal);

    const content = modal.querySelector('.modal-content');
    const timerDisplay = modal.querySelector('#breathTimer');
    const closeBtn = modal.querySelector('#closeModalBtn');

    content.focus();

    // Accessibility: trap focus inside modal
    trapFocus(content);

    closeBtn.onclick = () => closeModal();

    // Breathing cycle steps (seconds)
    const steps = [
      {text: 'Inhale...', duration: 4000},
      {text: 'Hold...', duration: 7000},
      {text: 'Exhale...', duration: 8000},
      {text: 'Hold...', duration: 4000}
    ];
    let stepIndex = 0;
    let cycles = 0;
    const maxCycles = 5;

    function runCycle() {
      if (cycles >= maxCycles) {
        timerDisplay.textContent = 'Done! Great job.';
        closeBtn.focus();
        return;
      }
      const step = steps[stepIndex];
      timerDisplay.textContent = step.text;
      setTimeout(() => {
        stepIndex = (stepIndex + 1) % steps.length;
        if (stepIndex === 0) cycles++;
        runCycle();
      }, step.duration);
    }
    setTimeout(runCycle, 1000);

    function closeModal() {
      // Animate fade out
      modal.style.animation = 'fadeOutModal 0.3s forwards';
      setTimeout(() => {
        modal.remove();
      }, 300);
    }

    // Close modal on Esc key
    modal.addEventListener('keydown', e => {
      if (e.key === 'Escape') closeModal();
    });
  }

  // --- Accessibility: Trap focus inside modal content ---
  function trapFocus(element) {
    const focusableSelectors = 'button, [href], input, textarea, select, [tabindex]:not([tabindex="-1"])';
    const focusableEls = element.querySelectorAll(focusableSelectors);
    if (focusableEls.length === 0) return;

    let firstFocusable = focusableEls[0];
    let lastFocusable = focusableEls[focusableEls.length -1];

    element.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        if (e.shiftKey) {
          if (document.activeElement === firstFocusable) {
            e.preventDefault();
            lastFocusable.focus();
          }
        } else {
          if (document.activeElement === lastFocusable) {
            e.preventDefault();
            firstFocusable.focus();
          }
        }
      }
      if (e.key === 'Escape') {
        // This is handled separately in modal creation
      }
    });
  }

  // --- Initialize ---
  document.addEventListener('DOMContentLoaded', () => {
    updateCounterDisplay();
    checkAchievements();
  });
</script>

</body>
</html>